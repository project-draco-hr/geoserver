{
  FeatureTypeInfo resource=getCatalog().getFeatureTypeByName("sf","PrimitiveGeoFeature");
  CatalogBuilder cb=new CatalogBuilder(getCatalog());
  ReferencedEnvelope nativeBounds=cb.getNativeBounds(resource);
  resource.setNativeBoundingBox(nativeBounds);
  resource.setLatLonBoundingBox(cb.getLatLonBounds(nativeBounds,resource.getCRS()));
  getCatalog().save(resource);
  assertNotNull(resource.getNativeBoundingBox());
  assertFalse(resource.getNativeBoundingBox().isEmpty());
  ReferencedEnvelope bbox=resource.getNativeBoundingBox();
  resource.setNativeBoundingBox(null);
  importer.calculateBounds(resource);
  assertFalse(resource.getNativeBoundingBox().isEmpty());
  assertEquals(bbox,resource.getNativeBoundingBox());
  resource.setNativeBoundingBox(new ReferencedEnvelope());
  assertTrue(resource.getNativeBoundingBox().isEmpty());
  importer.calculateBounds(resource);
  assertFalse(resource.getNativeBoundingBox().isEmpty());
  assertEquals(bbox,resource.getNativeBoundingBox());
  ReferencedEnvelope customBbox=new ReferencedEnvelope(30,60,-10,30,bbox.getCoordinateReferenceSystem());
  resource.setNativeBoundingBox(customBbox);
  assertFalse(bbox.equals(resource.getNativeBoundingBox()));
  importer.calculateBounds(resource);
  assertFalse(resource.getNativeBoundingBox().isEmpty());
  assertFalse(bbox.equals(resource.getNativeBoundingBox()));
  resource.setNativeBoundingBox(customBbox);
  resource.getMetadata().put("recalculate-bounds",false);
  assertFalse(bbox.equals(resource.getNativeBoundingBox()));
  importer.calculateBounds(resource);
  assertFalse(resource.getNativeBoundingBox().isEmpty());
  assertFalse(bbox.equals(resource.getNativeBoundingBox()));
  resource.setNativeBoundingBox(customBbox);
  resource.getMetadata().put("recalculate-bounds",true);
  assertFalse(bbox.equals(resource.getNativeBoundingBox()));
  importer.calculateBounds(resource);
  assertFalse(resource.getNativeBoundingBox().isEmpty());
  assertTrue(bbox.equals(resource.getNativeBoundingBox()));
  resource.setNativeBoundingBox(customBbox);
  resource.getMetadata().put("recalculate-bounds","true");
  assertFalse(bbox.equals(resource.getNativeBoundingBox()));
  importer.calculateBounds(resource);
  assertFalse(resource.getNativeBoundingBox().isEmpty());
  assertTrue(bbox.equals(resource.getNativeBoundingBox()));
}
