{
  final FormComponent[] components=getDependentFormComponents();
  final FormComponent wsComponent=components[0];
  final FormComponent nameComponent=components[1];
  WorkspaceInfo workspace=(WorkspaceInfo)wsComponent.getConvertedInput();
  String name=(String)nameComponent.getConvertedInput();
  if (workspace == null || StringUtils.isEmpty(name)) {
    if (required) {
      ValidationError error=new ValidationError();
      error.addMessageKey("NewLayerNameValidator.layerNameRequired");
      nameComponent.error((IValidationError)error);
    }
  }
 else {
    Catalog catalog=GeoServerApplication.get().getCatalog();
    ResourceInfo existing=catalog.getResourceByName(workspace.getName(),name,ResourceInfo.class);
    if (existing != null) {
      ValidationError error=new ValidationError();
      error.addMessageKey("NewLayerNameValidator.layerExistsInWorkspace");
      error.setVariable("workspace",workspace.getName());
      error.setVariable("layerName",name);
    }
  }
}
