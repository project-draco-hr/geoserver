{
  FilterFactory ff=CommonFactoryFinder.getFilterFactory(null);
  Filter filter=ff.id(new LinkedHashSet<Identifier>(Arrays.asList(ff.featureId("Fifteen.5"),ff.featureId("Fifteen.6"),ff.featureId("Fifteen.7"),ff.featureId("Fifteen.8"),ff.featureId("Fifteen.9"))));
  String xml=String.format("<GetFeature version='2.0.0' xmlns:gml='http://www.opengis.net/gml/2.0' " + "xmlns:fes='http://www.opengis.net/fes/2.0' startIndex='%d' count='%d'>" + "<Query typeNames = '%s'>"+ "  <fes:Filter>"+ "   <fes:ResourceId rid='%s'></fes:ResourceId>"+ "   <fes:ResourceId rid='%s'></fes:ResourceId>"+ "   <fes:ResourceId rid='%s'></fes:ResourceId>"+ "   <fes:ResourceId rid='%s'></fes:ResourceId>"+ "   <fes:ResourceId rid='%s'></fes:ResourceId>"+ "  </fes:Filter>"+ "</Query>"+ "</GetFeature>",0,2,typeName,"Fifteen.5","Fifteen.6","Fifteen.7","Fifteen.8","Fifteen.9");
  Document doc=postAsDOM("wfs",xml);
  XMLAssert.assertXpathEvaluatesTo("2","count(//" + typeName + ")",doc);
  XMLAssert.assertXpathEvaluatesTo("1","count(//" + typeName + "[@gml:id='Fifteen.5'])",doc);
  XMLAssert.assertXpathEvaluatesTo("1","count(//" + typeName + "[@gml:id='Fifteen.6'])",doc);
  assertFalse(doc.getDocumentElement().hasAttribute("previous"));
  assertTrue(doc.getDocumentElement().hasAttribute("next"));
  String next=doc.getDocumentElement().getAttribute("next");
  assertKvp(2,2,typeName,filter,toKvpMap(next));
  doc=getAsDOM(next.substring(next.indexOf("wfs")));
  XMLAssert.assertXpathEvaluatesTo("2","count(//" + typeName + ")",doc);
  XMLAssert.assertXpathEvaluatesTo("1","count(//" + typeName + "[@gml:id='Fifteen.7'])",doc);
  XMLAssert.assertXpathEvaluatesTo("1","count(//" + typeName + "[@gml:id='Fifteen.8'])",doc);
  assertTrue(doc.getDocumentElement().hasAttribute("previous"));
  assertTrue(doc.getDocumentElement().hasAttribute("next"));
  String prev=doc.getDocumentElement().getAttribute("previous");
  assertKvp(0,2,typeName,filter,toKvpMap(prev));
  next=doc.getDocumentElement().getAttribute("next");
  assertKvp(4,2,typeName,filter,toKvpMap(next));
  doc=getAsDOM(next.substring(next.indexOf("wfs")));
  XMLAssert.assertXpathEvaluatesTo("1","count(//" + typeName + ")",doc);
  XMLAssert.assertXpathEvaluatesTo("1","count(//" + typeName + "[@gml:id='Fifteen.9'])",doc);
  assertTrue(doc.getDocumentElement().hasAttribute("previous"));
  assertFalse(doc.getDocumentElement().hasAttribute("next"));
  prev=doc.getDocumentElement().getAttribute("previous");
  assertKvp(2,2,typeName,filter,toKvpMap(prev));
}
