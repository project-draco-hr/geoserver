{
  if (s == null) {
    throw new IllegalArgumentException("The String to parse may not be null.");
  }
  if (separator == '\\') {
    throw new IllegalArgumentException("The separator may not be a backslash.");
  }
  List<String> ret=new ArrayList<String>();
  StringBuilder sb=new StringBuilder();
  boolean escaped=false;
  for (int i=0; i < s.length(); i++) {
    char c=s.charAt(i);
    if (c == separator && !escaped) {
      ret.add(sb.toString());
      sb.setLength(0);
    }
 else {
      if (escaped) {
        escaped=false;
        sb.append('\\');
        sb.append(c);
      }
 else       if (c == '\\') {
        escaped=true;
      }
 else {
        sb.append(c);
      }
    }
  }
  if (escaped) {
    throw new IllegalStateException("The specified String ends with an incomplete escape sequence.");
  }
  ret.add(sb.toString());
  return ret;
}
