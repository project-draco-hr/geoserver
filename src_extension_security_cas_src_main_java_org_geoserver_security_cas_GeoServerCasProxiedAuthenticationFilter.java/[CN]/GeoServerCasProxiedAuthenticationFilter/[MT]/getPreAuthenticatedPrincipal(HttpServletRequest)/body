{
  String principal=super.getPreAuthenticatedPrincipal(request);
  if (principal != null && createSession) {
    HttpSession session=request.getSession();
    session.setAttribute(GeoServerCasConstants.CAS_ASSERTION_KEY,request.getAttribute(GeoServerCasConstants.CAS_ASSERTION_KEY));
    request.removeAttribute(GeoServerCasConstants.CAS_ASSERTION_KEY);
    getHandler().recordSession(request);
  }
  if (principal == null) {
    request.removeAttribute(GeoServerCasConstants.CAS_ASSERTION_KEY);
  }
  return principal;
}
