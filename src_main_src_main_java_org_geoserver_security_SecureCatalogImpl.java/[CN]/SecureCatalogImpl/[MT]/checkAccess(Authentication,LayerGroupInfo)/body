{
  if (group == null)   return null;
  WrapperPolicy policy=buildWrapperPolicy(user,group,group.getName());
  if (policy.level == AccessLevel.HIDDEN) {
    return null;
  }
  boolean needsWrapping=false;
  LayerInfo rootLayer=group.getRootLayer();
  if (LayerGroupInfo.Mode.EO.equals(group.getMode())) {
    LayerInfo checked=checkAccess(user,rootLayer);
    if (checked != null) {
      if (checked != rootLayer) {
        needsWrapping=true;
        rootLayer=checked;
      }
    }
 else {
      return null;
    }
  }
  final List<LayerInfo> layers=group.getLayers();
  ArrayList<LayerInfo> wrapped=new ArrayList<LayerInfo>(layers.size());
  for (  LayerInfo layer : layers) {
    LayerInfo checked=checkAccess(user,layer);
    if (checked != null) {
      if (checked != layer) {
        needsWrapping=true;
      }
      wrapped.add(checked);
    }
 else {
      needsWrapping=true;
    }
  }
  if (needsWrapping)   return new SecuredLayerGroupInfo(group,rootLayer,wrapped);
 else   return group;
}
