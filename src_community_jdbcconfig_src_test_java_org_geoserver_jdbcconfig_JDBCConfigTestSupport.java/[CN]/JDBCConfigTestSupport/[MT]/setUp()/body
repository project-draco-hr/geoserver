{
  ConfigDatabase.LOGGER.setLevel(Level.FINER);
  resourceLoader=new GeoServerResourceLoader(createTempDir());
  appContext=createNiceMock(WebApplicationContext.class);
  GeoServerExtensionsHelper.init(appContext);
  configureAppContext(appContext);
  replay(appContext);
  dataSource=dbConfig.dataSource();
  try {
    dropDb(dataSource);
  }
 catch (  Exception ignored) {
  }
  initDb(dataSource);
  AnnotationConfigApplicationContext context=new AnnotationConfigApplicationContext(Config.class);
  context.getBean(Config.class).real=dataSource;
  configDb=context.getBean(ConfigDatabase.class);
  catalog=new CatalogImpl();
  configDb.setCatalog(catalog);
  configDb.initDb(null);
}
