{
  if (layer.getResource() == null) {
    throw new NullPointerException("Layer resource must not be null");
  }
  if (null == getResourceByName(layer.getResource().getNamespace(),layer.getResource().getName(),ResourceInfo.class)) {
    throw new IllegalStateException("Found no resource named " + layer.prefixedName() + " , Layer with that name can't be added");
  }
  LayerInfo existing=getLayerByName(layer.getName());
  if (existing != null && !existing.getId().equals(layer.getId())) {
    if (existing.getResource().getNamespace().equals(layer.getResource().getNamespace())) {
      throw new IllegalArgumentException("Layer named '" + layer.getName() + "' already exists.");
    }
  }
  return postValidate(layer,isNew);
}
