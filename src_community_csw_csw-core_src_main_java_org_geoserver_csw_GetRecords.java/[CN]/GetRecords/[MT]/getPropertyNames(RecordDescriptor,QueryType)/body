{
  if (query.getElementName() != null && !query.getElementName().isEmpty()) {
    NamespaceSupport namespaces=rd.getNamespaceSupport();
    List<PropertyName> result=new ArrayList<PropertyName>();
    for (    QName qn : query.getElementName()) {
      String ns=qn.getNamespaceURI();
      String localName=qn.getLocalPart();
      PropertyName property=buildPropertyName(rd,namespaces,ns,localName);
      result.add(property);
    }
    return result;
  }
 else {
    ElementSetType elementSet=getElementSet(query);
    Set<Name> properties=rd.getPropertiesForElementSet(elementSet);
    if (properties != null) {
      NamespaceSupport namespaces=rd.getNamespaceSupport();
      List<PropertyName> result=new ArrayList<PropertyName>();
      for (      Name name : properties) {
        String ns=name.getNamespaceURI();
        String localName=name.getLocalPart();
        PropertyName property=buildPropertyName(rd,namespaces,ns,localName);
        result.add(property);
      }
      return result;
    }
 else {
      return null;
    }
  }
}
