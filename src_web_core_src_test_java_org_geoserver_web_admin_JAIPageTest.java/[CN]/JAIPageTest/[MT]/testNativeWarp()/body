{
  if (!ImageUtilities.isMediaLibAvailable()) {
    Assert.assertTrue(true);
    return;
  }
  GeoServer geoServer=getGeoServerApplication().getGeoServer();
  GeoServerInfo global=geoServer.getGlobal();
  JAIInfo info=(JAIInfo)global.getJAI();
  Assert.assertFalse(info.isAllowNativeWarp());
  JAIExt.registerJAIDescriptor("Warp");
  JAIEXTInfo jeinfo=info.getJAIEXTInfo();
  Set<String> jeOps=jeinfo.getJAIEXTOperations();
  jeOps.remove("Warp");
  jeinfo.setJAIEXTOperations(jeOps);
  jeinfo.getJAIOperations().add("Warp");
  info.setJAIEXTInfo(jeinfo);
  global.setJAI(info);
  geoServer.save(global);
  login();
  tester.startPage(JAIPage.class);
  tester.assertRenderedPage(JAIPage.class);
  tester.assertComponent("form:jaiext",JAIEXTPanel.class);
  tester.assertComponent("form:jaiext:jaiextOps",Palette.class);
  Palette p=(Palette)tester.getComponentFromLastRenderedPage("form:jaiext:jaiextOps");
  Collection jaiext=p.getChoices();
  assertNotNull(jaiext);
  assertTrue(!jaiext.contains("Warp"));
  FormTester form=tester.newFormTester("form");
  form.setValue("allowNativeWarp",true);
  form.submit("submit");
  tester.assertNoErrorMessage();
  info=(JAIInfo)global.getJAI();
  Assert.assertTrue(info.isAllowNativeWarp());
  Object factory=info.getJAI().getOperationRegistry().getFactory(RenderedRegistryMode.MODE_NAME,"Warp");
  Assert.assertTrue(factory instanceof MlibWarpRIF);
  tester.startPage(JAIPage.class);
  tester.assertRenderedPage(JAIPage.class);
  tester.assertComponent("form:jaiext",JAIEXTPanel.class);
  tester.assertComponent("form:jaiext:jaiextOps",Palette.class);
  p=(Palette)tester.getComponentFromLastRenderedPage("form:jaiext:jaiextOps");
  jaiext=p.getChoices();
  assertNotNull(jaiext);
  assertTrue(!jaiext.contains("Warp"));
  form=tester.newFormTester("form");
  form.setValue("allowNativeWarp",false);
  form.submit("submit");
  tester.assertNoErrorMessage();
  info=(JAIInfo)global.getJAI();
  Assert.assertFalse(info.isAllowNativeWarp());
  factory=info.getJAI().getOperationRegistry().getFactory(RenderedRegistryMode.MODE_NAME,"Warp");
  Assert.assertTrue(factory instanceof WarpRIF);
}
