{
  if (hasWriteLock())   return;
  if (lockFile.exists()) {
    LOGGER.warning("Cannot obtain  lock: " + lockFile.getCanonicalPath());
    FileInputStream in=new FileInputStream(lockFile);
    Properties props=new Properties();
    try {
      props.load(in);
    }
  finally {
      IOUtils.closeQuietly(in);
    }
    throw new IOException(Util.convertPropsToString(props,"Already locked"));
  }
 else {
    writeLockFileContent(lockFile);
    lockFileLastModified=lockFile.lastModified();
    lockFile.deleteOnExit();
    LOGGER.info("Successful lock: " + lockFile.getCanonicalPath());
  }
}
