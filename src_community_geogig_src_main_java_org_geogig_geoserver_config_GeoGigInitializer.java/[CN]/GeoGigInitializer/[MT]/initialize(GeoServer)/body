{
  Catalog catalog=geoServer.getCatalog();
  RepositoryManager.get().setCatalog(catalog);
  Map<URI,RepositoryInfo> allByLocation=getAllByLocation();
  Multimap<URI,DataStoreInfo> byRepo=storesByRepository(catalog);
  for (  URI repoURI : byRepo.keySet()) {
    if (!allByLocation.containsKey(repoURI)) {
      final RepositoryInfo info=create(repoURI);
      for (      DataStoreInfo dataStore : byRepo.get(repoURI)) {
        LOGGER.info(format("Upgrading config for GeoGig store %s to refer to GeoServer's RepositoryInfo %s",dataStore.getName(),info.getId()));
        Map<String,Serializable> params=dataStore.getConnectionParameters();
        params.put(REPOSITORY.key,info.getId());
        params.put(RESOLVER_CLASS_NAME.key,REPO_RESOLVER_CLASSNAME);
        catalog.save(dataStore);
      }
    }
  }
  catalog.addListener(new DeprecatedDataStoreConfigFixer());
}
