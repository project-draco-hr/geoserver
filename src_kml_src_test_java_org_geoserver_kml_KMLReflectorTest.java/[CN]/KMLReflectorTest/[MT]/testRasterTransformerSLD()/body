{
  URL url=getClass().getResource("allsymbolizers.sld");
  final String requestUrl="wms/kml?layers=" + getLayerId(MockData.BASIC_POLYGONS) + "&sld="+ url.toExternalForm()+ "&mode=download&KMSCORE=0";
  Document dom=getAsDOM(requestUrl);
  assertXpathEvaluatesTo("1","count(//kml:Folder/kml:GroundOverlay)",dom);
  String href=XMLUnit.newXpathEngine().evaluate("//kml:Folder/kml:GroundOverlay/kml:Icon/kml:href",dom);
  href=URLDecoder.decode(href,"UTF-8");
  assertTrue(href.startsWith("http://localhost:8080/geoserver/wms"));
  assertTrue(href.contains("request=GetMap"));
  assertTrue(href.contains("format=image/png"));
  assertTrue(href.contains("&sld=" + url.toExternalForm()));
}
