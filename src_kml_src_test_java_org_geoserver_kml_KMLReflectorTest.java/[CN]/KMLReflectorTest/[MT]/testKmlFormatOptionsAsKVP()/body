{
  final String layerName=MockData.BASIC_POLYGONS.getPrefix() + ":" + MockData.BASIC_POLYGONS.getLocalPart();
  final String baseUrl="wms/kml?layers=" + layerName + "&styles=&mode=superoverlay";
  final String requestUrl=baseUrl + "&kmltitle=myCustomLayerTitle&kmscore=10&legend=true&kmattr=true";
  Document dom=getAsDOM(requestUrl);
  XpathEngine xpath=XMLUnit.newXpathEngine();
  String result=xpath.evaluate("//kml:NetworkLink/kml:Link/kml:href",dom);
  Map<String,Object> kvp=KvpUtils.parseQueryString(result);
  String formatOptions=(String)kvp.get("format_options");
  assertEquals("LEGEND:true;SUPEROVERLAY:true;AUTOFIT:true;KMPLACEMARK:false;OVERLAYMODE:auto;KMSCORE:10;MODE:superoverlay;KMATTR:true;KMLTITLE:myCustomLayerTitle",formatOptions);
}
