{
  String workspace=getAttribute("workspace");
  WorkspaceInfo ws=geoServer.getCatalog().getWorkspaceByName(workspace);
  XStreamServiceLoader serviceLoader=null;
  for (  XStreamServiceLoader<ServiceInfo> loader : loaders) {
    if (loader.getFilename().equals(serviceXmlFileName)) {
      serviceLoader=loader;
    }
  }
  ServiceInfo original=null;
  File root=resourceLoader.find("");
  File workspaces=resourceLoader.find("workspaces");
  File workspaceDir=resourceLoader.find(workspaces + "/" + ws.getName());
  if (workspace != null) {
    if (geoServer.getService(ws,clazz) != null) {
      original=serviceLoader.load(geoServer,workspaceDir);
      OwsUtils.copy(object,original,clazz);
      serviceLoader.save(original,geoServer,workspaceDir);
    }
 else {
      ServiceInfo serviceInfo=(ServiceInfo)object;
      addDefaultsIfMissing(serviceInfo);
      serviceInfo.setWorkspace(ws);
      geoServer.add(serviceInfo);
    }
  }
 else {
    original=serviceLoader.load(geoServer,root);
    OwsUtils.copy(object,original,clazz);
    serviceLoader.save(original,geoServer,root);
  }
}
