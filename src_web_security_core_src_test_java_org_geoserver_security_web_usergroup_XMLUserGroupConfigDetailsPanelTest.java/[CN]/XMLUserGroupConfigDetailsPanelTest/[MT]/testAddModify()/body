{
  initializeForXML();
  activatePanel();
  assertEquals(2,countItems());
  assertNotNull(getSecurityNamedServiceConfig("default"));
  assertNotNull(getSecurityNamedServiceConfig("test"));
  assertNull(getSecurityNamedServiceConfig("xxxxxxxx"));
  clickAddNew();
  tester.assertRenderedPage(SecurityNamedServiceNewPage.class);
  setSecurityConfigClassName(XMLUserGroupServicePanelInfo.class);
  newFormTester();
  setSecurityConfigName("default2");
  setFileName("abc.xml");
  setCheckInterval(5000);
  setValidating(true);
  clickCancel();
  tester.assertRenderedPage(basePage.getClass());
  assertEquals(2,countItems());
  assertNotNull(getSecurityNamedServiceConfig("default"));
  clickAddNew();
  tester.assertRenderedPage(SecurityNamedServiceNewPage.class);
  setSecurityConfigClassName(XMLUserGroupServicePanelInfo.class);
  newFormTester();
  setPasswordEncoderName(getDigestPasswordEncoder().getName());
  setPasswordPolicy("default");
  setSecurityConfigName("default2");
  setFileName("abc.xml");
  setCheckInterval(5000);
  setValidating(true);
  clickSave();
  tester.assertNoErrorMessage();
  tester.assertRenderedPage(basePage.getClass());
  assertEquals(3,countItems());
  assertNotNull(getSecurityNamedServiceConfig("default"));
  XMLUserGroupServiceConfig xmlConfig=(XMLUserGroupServiceConfig)getSecurityNamedServiceConfig("default2");
  assertNotNull(xmlConfig);
  assertEquals("default2",xmlConfig.getName());
  assertEquals(XMLUserGroupService.class.getName(),xmlConfig.getClassName());
  assertEquals(getDigestPasswordEncoder().getName(),xmlConfig.getPasswordEncoderName());
  assertEquals(PasswordValidatorImpl.DEFAULT_NAME,xmlConfig.getPasswordPolicyName());
  assertEquals("abc.xml",xmlConfig.getFileName());
  assertEquals(5000,xmlConfig.getCheckInterval());
  assertEquals(true,xmlConfig.isValidating());
  xmlConfig=(XMLUserGroupServiceConfig)getSecurityManager().loadUserGroupServiceConfig("default2");
  assertNotNull(xmlConfig);
  assertEquals("default2",xmlConfig.getName());
  assertEquals(getDigestPasswordEncoder().getName(),xmlConfig.getPasswordEncoderName());
  assertEquals(PasswordValidatorImpl.DEFAULT_NAME,xmlConfig.getPasswordPolicyName());
  assertEquals("abc.xml",xmlConfig.getFileName());
  assertEquals(5000,xmlConfig.getCheckInterval());
  assertEquals(true,xmlConfig.isValidating());
  clickAddNew();
  newFormTester();
  setSecurityConfigClassName(XMLUserGroupServicePanelInfo.class);
  newFormTester();
  setSecurityConfigName("default2");
  clickSave();
  tester.assertRenderedPage(SecurityNamedServiceNewPage.class);
  testErrorMessagesWithRegExp(".*default2.*");
  clickCancel();
  tester.assertRenderedPage(basePage.getClass());
  clickNamedServiceConfig("default");
  tester.assertRenderedPage(SecurityNamedServiceEditPage.class);
  newFormTester("panel:panel:panel:form");
  formTester.setValue("panel:passwordPolicyName",PasswordValidatorImpl.MASTERPASSWORD_NAME);
  formTester.setValue("panel:passwordEncoderName",getPlainTextPasswordEncoder().getName());
  assertEquals(getDigestPasswordEncoder().getName(),xmlConfig.getPasswordEncoderName());
  assertEquals(PasswordValidatorImpl.DEFAULT_NAME,xmlConfig.getPasswordPolicyName());
  formTester.setValue("panel:checkInterval","5001");
  formTester.setValue("panel:validating",true);
  clickCancel();
  tester.assertRenderedPage(basePage.getClass());
  xmlConfig=(XMLUserGroupServiceConfig)getSecurityNamedServiceConfig("default");
  assertEquals(getDigestPasswordEncoder().getName(),xmlConfig.getPasswordEncoderName());
  assertEquals(PasswordValidatorImpl.DEFAULT_NAME,xmlConfig.getPasswordPolicyName());
  assertEquals("users.xml",xmlConfig.getFileName());
  assertEquals(10000,xmlConfig.getCheckInterval());
  assertEquals(true,xmlConfig.isValidating());
  clickNamedServiceConfig("default2");
  newFormTester("panel:panel:panel:form");
  formTester.setValue("panel:passwordPolicyName",PasswordValidatorImpl.MASTERPASSWORD_NAME);
  formTester.setValue("panel:checkInterval","5001");
  formTester.setValue("panel:validating",false);
  clickSave();
  tester.assertNoErrorMessage();
  tester.assertRenderedPage(basePage.getClass());
  xmlConfig=(XMLUserGroupServiceConfig)getSecurityNamedServiceConfig("default2");
  assertEquals(getDigestPasswordEncoder().getName(),xmlConfig.getPasswordEncoderName());
  assertEquals(PasswordValidatorImpl.MASTERPASSWORD_NAME,xmlConfig.getPasswordPolicyName());
  assertEquals("abc.xml",xmlConfig.getFileName());
  assertEquals(5001,xmlConfig.getCheckInterval());
  assertEquals(false,xmlConfig.isValidating());
  xmlConfig=(XMLUserGroupServiceConfig)getSecurityManager().loadUserGroupServiceConfig("default2");
  assertEquals(getDigestPasswordEncoder().getName(),xmlConfig.getPasswordEncoderName());
  assertEquals(PasswordValidatorImpl.MASTERPASSWORD_NAME,xmlConfig.getPasswordPolicyName());
  assertEquals("abc.xml",xmlConfig.getFileName());
  assertEquals(5001,xmlConfig.getCheckInterval());
  assertEquals(false,xmlConfig.isValidating());
}
