{
  if (listener == null) {
    final List<XStreamServiceLoader> loaders=GeoServerExtensions.extensions(XStreamServiceLoader.class);
    listener=new ConfigurationListenerAdapter(){
      @Override public void handlePostServiceChange(      ServiceInfo service){
        for (        XStreamServiceLoader<ServiceInfo> l : loaders) {
          if (l.getServiceClass().isInstance(service)) {
            try {
              l.save(service,geoServer);
            }
 catch (            Throwable t) {
              LOGGER.log(Level.SEVERE,"Error occurred while saving configuration",t);
            }
          }
        }
      }
    }
;
    geoServer.addListener(listener);
  }
  try {
    if (this.persister != null) {
      geoserver.removeListener(persister);
    }
 else {
      this.persister=new GeoServerPersister(resourceLoader,xp);
    }
    readConfiguration(geoServer,xp);
  }
  finally {
    geoserver.addListener(persister);
  }
}
