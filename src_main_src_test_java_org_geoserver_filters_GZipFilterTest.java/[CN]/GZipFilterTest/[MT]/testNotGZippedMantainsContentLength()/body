{
  MockHttpServletRequest request=new MockHttpServletRequest();
  request.setRequestURL("http://www.geoserver.org");
  request.setHeader("accept-encoding","gzip");
  MockHttpServletResponse response=new MockHttpServletResponse();
  response.setContentType("text/css");
  GZIPFilter filter=new GZIPFilter();
  MockFilterConfig config=new MockFilterConfig();
  MockServletContext context=new MockServletContext();
  context.setInitParameter("compressed-types","text/plain");
  config.setupServletContext(context);
  filter.init(config);
  MockFilterChain chain=new MockFilterChain(){
    @Override public void doFilter(    ServletRequest request,    ServletResponse response) throws IOException, ServletException {
      response.setContentLength(1000);
      AlternativesResponseStream alternatives=(AlternativesResponseStream)response.getOutputStream();
      ServletOutputStream gzipStream=alternatives.getStream();
      gzipStream.write(1);
    }
  }
;
  filter.doFilter(request,response,chain);
  assertTrue(response.containsHeader("Content-Length"));
  assertEquals("1000",response.getHeader("Content-Length"));
}
