{
  QName typeName=new QName("http://www.openplans.org/spearfish","restricted");
  PostDiffType postDiff=new PostDiffType();
  postDiff.setFromVersion(-1);
  postDiff.setToVersion(-1);
  postDiff.setTypeName(typeName);
  postDiff.setTransaction(WfsFactory.eINSTANCE.createTransactionType());
  GSSClient client=createMock(GSSClient.class);
  expect(client.getCentralRevision((QName)anyObject())).andReturn(new Long(-1));
  client.postDiff(postDiff);
  expect(client.getDiff((GetDiffType)anyObject())).andReturn(new GetDiffResponseType());
  replay(client);
  GSSClientFactory factory=createMock(GSSClientFactory.class);
  expect(factory.createClient(new URL("http://localhost:8081/geoserver/ows"),null,null)).andReturn(client);
  replay(factory);
  synch.clientFactory=factory;
  Date start=new Date();
  synch.synchronizeOustandlingLayers();
  Date end=new Date();
  SimpleFeature f=getSingleFeature(fsUnitTables,ff.equal(ff.property("table_id"),ff.literal(1),false));
  Date lastSynch=(Date)f.getAttribute("last_synchronization");
  assertNotNull(lastSynch);
  assertTrue(lastSynch.compareTo(start) >= 0 && lastSynch.compareTo(end) <= 0);
  assertNull(f.getAttribute("last_failure"));
  f=getSingleFeature(fsUnits,ff.equal(ff.property("unit_name"),ff.literal("unit1"),false));
  assertFalse((Boolean)f.getAttribute("errors"));
}
