{
  if (layer.getResource().getId() != null) {
    Query query=query("from ",layer.getResource().getClass()," where id = ",param(layer.getResource().getId()));
    layer.setResource((ResourceInfo)first(query));
  }
  if (layer.getDefaultStyle() != null) {
    Query query=query("from ",StyleInfo.class," where id = ",param(layer.getDefaultStyle().getId()));
    layer.setDefaultStyle((StyleInfo)first(query));
  }
  return persist(layer);
}
