{
  GeofenceRulesModel model=new GeofenceRulesModel();
  ShortRule rule1=model.newRule();
  rule1.setUserName("pipo");
  model.save(rule1);
  ShortRule rule2=model.newRule();
  rule2.setUserName("jantje");
  model.save(rule2);
  ShortRule rule3=model.newRule();
  rule3.setUserName("oen");
  model.save(rule3);
  assertEquals(3,model.getItems().size());
  assertEquals(rule1,model.getItems().get(2));
  assertEquals(rule2,model.getItems().get(1));
  assertEquals(rule3,model.getItems().get(0));
  assertEquals(0,rule3.getPriority());
  assertEquals(1,rule2.getPriority());
  assertEquals(2,rule1.getPriority());
  assertSynchronized(model);
  assertFalse(model.canDown(rule1));
  assertFalse(model.canUp(rule3));
  assertTrue(model.canDown(rule2));
  assertTrue(model.canUp(rule2));
  model.moveDown(rule2);
  model.moveUp(rule3);
  assertEquals(rule3,model.getItems().get(0));
  assertEquals(rule1,model.getItems().get(1));
  assertEquals(rule2,model.getItems().get(2));
  assertEquals(0,rule3.getPriority());
  assertEquals(1,rule1.getPriority());
  assertEquals(2,rule2.getPriority());
  rule2.setService("WFS");
  model.save(rule2);
  model.remove(Arrays.asList(rule1,rule3));
  assertEquals(1,model.getItems().size());
  assertSynchronized(model);
}
