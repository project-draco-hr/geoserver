{
  File newFile=new File(directory,fileName);
  final InputStream inStream=request.getEntity().getStream();
  final String stringURL=IOUtils.getStringFromStream(inStream);
  final URL fileURL=new URL(stringURL);
  final File inputFile=IOUtils.URLToFile(fileURL);
  if (inputFile != null && inputFile.exists() && inputFile.canRead()) {
    IOUtils.copyFile(inputFile,newFile);
  }
 else {
    final InputStream inputStream=fileURL.openStream();
    final OutputStream outStream=new FileOutputStream(newFile);
    IOUtils.copyStream(inputStream,outStream,true,true);
  }
  return newFile;
}
