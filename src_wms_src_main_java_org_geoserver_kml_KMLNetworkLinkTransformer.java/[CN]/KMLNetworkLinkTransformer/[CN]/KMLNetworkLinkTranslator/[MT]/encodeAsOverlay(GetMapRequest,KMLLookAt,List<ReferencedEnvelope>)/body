{
  final List<MapLayerInfo> layers=request.getLayers();
  final List<Style> styles=request.getStyles();
  for (int i=0; i < layers.size(); i++) {
    MapLayerInfo layerInfo=layers.get(i);
    start("NetworkLink");
    element("name",layerInfo.getName());
    element("visibility","1");
    element("open","1");
    ReferencedEnvelope latLongBoundingBox=layerBounds.get(i);
    if (latLongBoundingBox != null) {
      encodeLookAt(latLongBoundingBox,lookAt);
    }
    start("Url");
    request.setBbox(null);
    String style=i < styles.size() ? styles.get(i).getName() : null;
    String href=WMSRequests.getGetMapUrl(request,layers.get(i).getName(),i,style,null,null);
    try {
      href=URLDecoder.decode(href,"UTF-8");
    }
 catch (    UnsupportedEncodingException e) {
      throw new RuntimeException(e);
    }
    start("href");
    cdata(href);
    end("href");
    element("viewRefreshMode","onStop");
    element("viewRefreshTime","1");
    end("Url");
    end("NetworkLink");
  }
}
