{
  persister.setCallback(new XStreamPersister.Callback(){
    @Override protected void postEncodeReference(    Object obj,    String ref,    HierarchicalStreamWriter writer,    MarshallingContext context){
      if (obj instanceof StyleInfo) {
        encodeLink("/styles/" + encode(((StyleInfo)obj).getName()),writer);
      }
      if (obj instanceof ResourceInfo) {
        ResourceInfo r=(ResourceInfo)obj;
        StringBuffer link=new StringBuffer("/workspaces/").append(encode(r.getStore().getWorkspace().getName())).append("/");
        if (r instanceof FeatureTypeInfo) {
          link.append("datastores/").append(encode(r.getStore().getName())).append("/featuretypes/");
        }
 else         if (r instanceof CoverageInfo) {
          link.append("coveragestores/").append(encode(r.getStore().getName())).append("/coverages/");
        }
 else         if (r instanceof WMSLayerInfo) {
          link.append("wmsstores/").append(encode(r.getStore().getName())).append("/wmslayers/");
        }
 else {
          return;
        }
        link.append(encode(r.getName()));
        encodeLink(link.toString(),writer);
      }
    }
  }
);
}
