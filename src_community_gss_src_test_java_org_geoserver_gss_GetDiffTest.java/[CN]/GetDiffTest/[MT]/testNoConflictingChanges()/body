{
  VersioningFeatureStore restricted=(VersioningFeatureStore)synchStore.getFeatureSource("restricted");
  SimpleFeatureType schema=restricted.getSchema();
  Id updateFilter=ff.id(singleton(ff.featureId("restricted.1b99be2b-2480-4742-ad52-95c294efda3b")));
  restricted.modifyFeatures(schema.getDescriptor("cat"),450,updateFilter);
  Id removeFilter=ff.id(singleton(ff.featureId("restricted.c15e76ab-e44b-423e-8f85-f6d9927b878a")));
  restricted.removeFeatures(removeFilter);
  assertEquals(3,restricted.getCount(Query.ALL));
  MockHttpServletResponse response=postAsServletResponse(root(true),loadTextResource("PostDiffInitial.xml"));
  checkPostDiffSuccessResponse(response);
  assertEquals(0,gss.getActiveConflicts("restricted").size());
  response=postAsServletResponse(root(true),loadTextResource("GetDiffInitial.xml"));
  validate(response);
  Document dom=dom(response);
  assertXpathEvaluatesTo("-1","/gss:GetDiffResponse/@fromVersion",dom);
  assertXpathEvaluatesTo("6","/gss:GetDiffResponse/@toVersion",dom);
  assertXpathEvaluatesTo("sf:restricted","/gss:GetDiffResponse/@typeName",dom);
  assertXpathEvaluatesTo("2","count(/gss:GetDiffResponse/gss:Changes/*)",dom);
  assertXpathEvaluatesTo("sf:restricted","/gss:GetDiffResponse/gss:Changes/wfs:Update/@typeName",dom);
  assertXpathEvaluatesTo("1","count(/gss:GetDiffResponse/gss:Changes/wfs:Update/ogc:Filter/ogc:FeatureId)",dom);
  assertXpathEvaluatesTo("restricted.1b99be2b-2480-4742-ad52-95c294efda3b","/gss:GetDiffResponse/gss:Changes/wfs:Update/ogc:Filter/ogc:FeatureId/@fid",dom);
  assertXpathEvaluatesTo("1","count(/gss:GetDiffResponse/gss:Changes/wfs:Update/wfs:Property)",dom);
  assertXpathEvaluatesTo("cat","/gss:GetDiffResponse/gss:Changes/wfs:Update/wfs:Property/wfs:Name",dom);
  assertXpathEvaluatesTo("450","/gss:GetDiffResponse/gss:Changes/wfs:Update/wfs:Property/wfs:Value",dom);
  assertXpathEvaluatesTo("sf:restricted","/gss:GetDiffResponse/gss:Changes/wfs:Delete/@typeName",dom);
  assertXpathEvaluatesTo("restricted.c15e76ab-e44b-423e-8f85-f6d9927b878a","/gss:GetDiffResponse/gss:Changes/wfs:Delete/ogc:Filter/ogc:FeatureId/@fid",dom);
  assertXpathEvaluatesTo("restricted.c15e76ab-e44b-423e-8f85-f6d9927b878a","/gss:GetDiffResponse/gss:Changes/wfs:Delete/ogc:Filter/ogc:FeatureId/@fid",dom);
}
