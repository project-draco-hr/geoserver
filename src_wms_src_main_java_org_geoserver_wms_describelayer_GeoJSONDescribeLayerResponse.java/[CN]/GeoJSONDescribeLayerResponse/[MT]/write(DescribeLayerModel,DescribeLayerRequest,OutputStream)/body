{
switch (type) {
case JSON:
    OutputStreamWriter outWriter=null;
  try {
    outWriter=new OutputStreamWriter(output,wms.getGeoServer().getSettings().getCharset());
    writeJSON(outWriter,layers);
  }
  finally {
    if (outWriter != null) {
      outWriter.flush();
      IOUtils.closeQuietly(outWriter);
    }
  }
case JSONP:
writeJSONP(output,layers);
}
}
