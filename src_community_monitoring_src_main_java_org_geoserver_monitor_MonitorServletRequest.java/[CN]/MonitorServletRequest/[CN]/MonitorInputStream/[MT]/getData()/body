{
  if (bufferIsFull()) {
    return buffer.array();
  }
  byte[] data=new byte[buffer.position()];
  ((ByteBuffer)buffer.duplicate().reset()).get(data);
  return data;
}
