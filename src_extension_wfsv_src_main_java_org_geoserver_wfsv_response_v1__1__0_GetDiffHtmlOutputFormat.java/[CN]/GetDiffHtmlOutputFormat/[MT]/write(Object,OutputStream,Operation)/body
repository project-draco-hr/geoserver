{
  FeatureDiffReader[] diffReaders=(FeatureDiffReader[])value;
  GeoServerTemplateLoader templateLoader=new GeoServerTemplateLoader(getClass());
  templateLoader.setFeatureType(diffReaders[0].getSchema());
  Template template=null;
synchronized (templateConfig) {
    templateConfig.setTemplateLoader(templateLoader);
    template=templateConfig.getTemplate("wfsvGetDiff.ftl");
  }
  try {
    template.setOutputEncoding("UTF-8");
    template.process(diffReaders,new OutputStreamWriter(output,Charset.forName("UTF-8")));
  }
 catch (  TemplateException e) {
    String msg="Error occured processing template.";
    throw (IOException)new IOException(msg).initCause(e);
  }
 finally {
    for (int i=0; i < diffReaders.length; i++) {
      diffReaders[i].close();
    }
  }
}
