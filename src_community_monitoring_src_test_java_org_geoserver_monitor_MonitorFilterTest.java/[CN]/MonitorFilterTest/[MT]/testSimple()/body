{
  DummyMonitorDAO dao=new DummyMonitorDAO();
  MonitorFilter filter=new MonitorFilter(new Monitor(dao),new MonitorRequestFilter());
  MockFilterChain chain=new MockFilterChain();
  HttpServletRequest req=request("GET","/foo/bar","12.34.56.78",null);
  filter.doFilter(req,response(),chain);
  RequestData data=dao.getLast();
  assertEquals("GET",data.getHttpMethod());
  assertEquals("/foo/bar",data.getPath());
  assertEquals("12.34.56.78",data.getRemoteAddr());
  chain.setServlet(new HttpServlet(){
    @Override public void service(    ServletRequest req,    ServletResponse res) throws ServletException, IOException {
      req.getInputStream().read(new byte[10]);
      res.getOutputStream().write("hello".getBytes());
    }
  }
);
  req=request("POST","/bar/foo","78.56.34.12","baz");
  filter.doFilter(req,response(),chain);
  data=dao.getLast();
  assertEquals("POST",data.getHttpMethod());
  assertEquals("/bar/foo",data.getPath());
  assertEquals("78.56.34.12",data.getRemoteAddr());
  assertEquals(new String(data.getBody()),"baz");
  assertEquals(5,data.getResponseLength());
}
