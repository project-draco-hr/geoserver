{
  chain.setServlet(new HttpServlet(){
    @Override public void service(    ServletRequest req,    ServletResponse res) throws ServletException, IOException {
      req.getInputStream().read(new byte[10]);
      res.getOutputStream().write("hello".getBytes());
    }
  }
);
  HttpServletRequest req=request("POST","/bar/foo","78.56.34.12","baz",null);
  filter.doFilter(req,response(),chain);
  RequestData data=dao.getLast();
  assertEquals("POST",data.getHttpMethod());
  assertEquals("/bar/foo",data.getPath());
  assertEquals("78.56.34.12",data.getRemoteAddr());
  assertNull(data.getReferer());
  assertEquals(new String(data.getBody()),"baz");
  assertEquals(5,data.getResponseLength());
}
