{
  try {
    StyleInfo info=page.getStyleInfo();
    if (CssHandler.FORMAT.equals(info.getFormat())) {
      page.catalog().getResourcePool().writeStyle(info,new ByteArrayInputStream(styleBody.getObject().getBytes()));
    }
 else {
      String sld=page.cssText2sldText(styleBody.getObject(),info);
      Writer writer=new FileWriter(cssFile);
      writer.write(styleBody.getObject());
      writer.close();
      page.catalog().getResourcePool().writeStyle(page.getStyleInfo(),new ByteArrayInputStream(sld.getBytes()));
    }
    page.catalog().save(info);
    if (page.sldPreview != null)     target.addComponent(page.sldPreview);
    if (page.map != null)     target.appendJavascript(page.map.getUpdateCommand());
  }
 catch (  Exception e) {
    throw new WicketRuntimeException(e);
  }
}
