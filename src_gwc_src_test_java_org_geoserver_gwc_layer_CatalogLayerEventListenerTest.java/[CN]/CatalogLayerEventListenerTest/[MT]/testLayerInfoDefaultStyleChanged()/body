{
  final String oldName="oldStyle";
  final String newName="newStyle";
  StyleInfo oldStyle=mock(StyleInfo.class);
  when(oldStyle.getName()).thenReturn(oldName);
  StyleInfo newStyle=mock(StyleInfo.class);
  when(newStyle.getName()).thenReturn(newName);
  when(mockLayerInfo.getDefaultStyle()).thenReturn(newStyle);
  CatalogModifyEvent modifyEvent=mock(CatalogModifyEvent.class);
  when(modifyEvent.getSource()).thenReturn(mockLayerInfo);
  when(modifyEvent.getPropertyNames()).thenReturn(Arrays.asList("defaultStyle"));
  when(modifyEvent.getOldValues()).thenReturn(Collections.singletonList((Object)oldStyle));
  when(modifyEvent.getNewValues()).thenReturn(Collections.singletonList((Object)newStyle));
  GeoServerTileLayer tileLayer=mock(GeoServerTileLayer.class);
  when(mockMediator.getTileLayerByName(eq(PREFIXED_RESOURCE_NAME))).thenReturn(tileLayer);
  GeoServerTileLayer lgTileLayer=mock(GeoServerTileLayer.class);
  when(mockMediator.getTileLayer(mockLayerGroupInfo)).thenReturn(lgTileLayer);
  GeoServerTileLayerInfo info=TileLayerInfoUtil.loadOrCreate(mockLayerInfo,GWCConfig.getOldDefaults());
  when(tileLayer.getInfo()).thenReturn(info);
  GeoServerTileLayerInfo groupInfo=TileLayerInfoUtil.loadOrCreate(mockLayerGroupInfo,GWCConfig.getOldDefaults());
  when(lgTileLayer.getInfo()).thenReturn(groupInfo);
  when(mockMediator.hasTileLayer(same(mockLayerInfo))).thenReturn(true);
  when(mockMediator.getTileLayer(same(mockLayerInfo))).thenReturn(tileLayer);
  listener.handleModifyEvent(modifyEvent);
  CatalogPostModifyEvent postModifyEvent=mock(CatalogPostModifyEvent.class);
  when(postModifyEvent.getSource()).thenReturn(mockLayerInfo);
  listener.handlePostModifyEvent(postModifyEvent);
  verify(mockMediator).truncateByLayerAndStyle(eq(PREFIXED_RESOURCE_NAME),eq(oldName));
  verify(mockMediator,times(2)).save(any(GeoServerTileLayer.class));
  verify(mockMediator).truncate(LAYER_GROUP_NAME);
}
