{
  String masterPWAsString=getMasterPassword();
  GeoServerRootAuthenticationProvider authProvider=new GeoServerRootAuthenticationProvider();
  authProvider.setSecurityManager(getSecurityManager());
  Authentication auth=new UsernamePasswordAuthenticationToken("root",masterPWAsString);
  auth=authProvider.authenticate(auth);
  assertTrue(auth.isAuthenticated());
  MasterPasswordConfig config=getSecurityManager().getMasterPasswordConfig();
  getSecurityManager().saveMasterPasswordConfig(config,masterPWAsString.toCharArray(),"geoserver1".toCharArray(),"geoserver1".toCharArray());
  assertEquals("geoserver1",getMasterPassword());
  auth=new UsernamePasswordAuthenticationToken("root",masterPWAsString);
  assertNull(authProvider.authenticate(auth));
  assertFalse(auth.isAuthenticated());
  auth=new UsernamePasswordAuthenticationToken("root","geoserver1");
  auth=authProvider.authenticate(auth);
  assertTrue(auth.isAuthenticated());
}
