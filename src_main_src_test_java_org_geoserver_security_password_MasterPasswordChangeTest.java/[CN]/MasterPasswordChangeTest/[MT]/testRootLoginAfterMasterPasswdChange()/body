{
  assertEquals(new String(MASTER_PASSWD_DEFAULT),getMasterPassword());
  GeoServerRootAuthenticationProvider authProvider=new GeoServerRootAuthenticationProvider();
  authProvider.setSecurityManager(getSecurityManager());
  Authentication auth=new UsernamePasswordAuthenticationToken("root","geoserver");
  auth=authProvider.authenticate(auth);
  assertTrue(auth.isAuthenticated());
  MasterPasswordConfig config=getSecurityManager().getMasterPasswordConfig();
  getSecurityManager().saveMasterPasswordConfig(config,MASTER_PASSWD_DEFAULT,"geoserver1".toCharArray(),"geoserver1".toCharArray());
  assertEquals("geoserver1",getMasterPassword());
  auth=new UsernamePasswordAuthenticationToken("root","geoserver");
  assertNull(authProvider.authenticate(auth));
  assertFalse(auth.isAuthenticated());
  auth=new UsernamePasswordAuthenticationToken("root","geoserver1");
  auth=authProvider.authenticate(auth);
  assertTrue(auth.isAuthenticated());
}
