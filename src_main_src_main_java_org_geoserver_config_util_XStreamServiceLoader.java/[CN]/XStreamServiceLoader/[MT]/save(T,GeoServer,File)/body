{
  String filename=getFilename();
  File file=resourceLoader.find(directory,filename);
  if (file == null) {
    file=resourceLoader.createFile(directory,filename);
  }
  BufferedOutputStream out=new BufferedOutputStream(new FileOutputStream(file));
  try {
    XStreamPersister xp=xpf.createXMLPersister();
    initXStreamPersister(xp,gs);
    xp.save(service,out);
    out.flush();
  }
  finally {
    out.close();
  }
}
