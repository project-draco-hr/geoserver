{
  String listOfStyles=(String)rawKvp.get("STYLE");
  if (listOfStyles == null) {
    listOfStyles="";
  }
  List<String> styleNames=KvpUtils.readFlat(listOfStyles);
  String sldUrl=(String)rawKvp.get("SLD");
  String sldBody=(String)rawKvp.get("SLD_BODY");
  if (LOGGER.isLoggable(Level.FINE)) {
    LOGGER.fine(new StringBuffer("looking for styles ").append(listOfStyles).toString());
  }
  List<Style> sldStyles=new ArrayList<Style>();
  if (sldUrl != null) {
    if (LOGGER.isLoggable(Level.FINER)) {
      LOGGER.finer("taking style from SLD parameter");
    }
    addStylesFrom(sldStyles,styleNames,loadRemoteStyle(sldUrl));
  }
 else   if (sldBody != null) {
    if (LOGGER.isLoggable(Level.FINER)) {
      LOGGER.finer("taking style from SLD_BODY parameter");
    }
    addStylesFrom(sldStyles,styleNames,parseSldBody(sldBody));
  }
 else   if (styleNames.size() > 0) {
    if (LOGGER.isLoggable(Level.FINER)) {
      LOGGER.finer("taking style from STYLE parameter");
    }
    int pos=0;
    for (    String styleName : styleNames) {
      if (styleName.equals("") && infoObj instanceof LayerGroupInfo) {
        LayerGroupInfo layerGroupInfo=(LayerGroupInfo)infoObj;
        List<LayerInfo> groupLayers=layerGroupInfo.layers();
        if (pos < groupLayers.size()) {
          sldStyles.add(getStyleFromLayer(groupLayers.get(pos)));
        }
      }
 else {
        sldStyles.add(wms.getStyleByName(styleName));
      }
      pos++;
    }
  }
 else {
    if (infoObj instanceof LayerInfo) {
      sldStyles.add(getStyleFromLayer((LayerInfo)infoObj));
    }
 else     if (infoObj instanceof LayerGroupInfo) {
      LayerGroupInfo layerGroupInfo=(LayerGroupInfo)infoObj;
      List<LayerInfo> groupLayers=layerGroupInfo.layers();
      List<StyleInfo> groupStyles=layerGroupInfo.styles();
      for (int count=0; count < groupLayers.size(); count++) {
        if (count < groupStyles.size() && groupStyles.get(count) != null) {
          sldStyles.add(groupStyles.get(count).getStyle());
        }
 else {
          LayerInfo layerInfo=groupLayers.get(count);
          sldStyles.add(getStyleFromLayer(layerInfo));
        }
      }
    }
  }
  req.setStyles(sldStyles);
  String rule=(String)rawKvp.get("RULE");
  if (rule != null) {
    List<String> ruleNames=KvpUtils.readFlat(rule);
    req.setRules(ruleNames);
  }
}
