{
  GeoServerDataDirectory dd=new GeoServerDataDirectory(catalog.getResourceLoader());
  File styles;
  if (ws == null) {
    styles=dd.findOrCreateStyleDir();
  }
 else {
    styles=new File(dd.findOrCreateWorkspaceDir(ws),"styles");
    styles.mkdir();
  }
  String target=new File(filename).getName();
  catalog.getResourceLoader().copyFromClassPath(filename,new File(styles,target),scope);
  StyleInfo style=catalog.getStyleByName(ws,name);
  if (style == null) {
    style=catalog.getFactory().createStyle();
    style.setName(name);
    style.setWorkspace(ws);
  }
  style.setFilename(target);
  if (style.getId() == null) {
    catalog.add(style);
  }
 else {
    catalog.save(style);
  }
}
