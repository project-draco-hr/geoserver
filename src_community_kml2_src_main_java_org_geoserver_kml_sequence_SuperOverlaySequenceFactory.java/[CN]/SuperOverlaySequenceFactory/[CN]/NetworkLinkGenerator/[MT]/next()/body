{
  while (i < size) {
    WMSMapContent mapContent=context.getMapContent();
    List<Layer> layers=mapContent.layers();
    Layer layer=layers.get(i++);
    context.setCurrentLayer(layer);
    NetworkLink nl;
    if ("cached".equals(context.getSuperOverlayMode()) && KMLUtils.isRequestGWCCompatible(context.getMapContent(),layer,context.getWms())) {
      nl=encodeAsCachedTiles(layer);
    }
 else {
      nl=encodeAsSuperOverlay(layer);
    }
    for (    KmlDecorator decorator : decorators) {
      nl=(NetworkLink)decorator.decorate(nl,context);
      if (nl == null) {
        continue;
      }
    }
    return nl;
  }
  return null;
}
