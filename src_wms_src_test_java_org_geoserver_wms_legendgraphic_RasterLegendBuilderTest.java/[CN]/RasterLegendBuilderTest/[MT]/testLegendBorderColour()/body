{
  StyleBuilder sb=new StyleBuilder();
  ColorMap cmap=sb.createColorMap(new String[]{null,null,null},new double[]{Double.NEGATIVE_INFINITY,50,Double.POSITIVE_INFINITY},new Color[]{Color.RED,Color.WHITE,Color.BLUE},ColorMap.TYPE_INTERVALS);
  Style style=sb.createStyle(sb.createRasterSymbolizer(cmap,1));
  Color colourToTest=LegendUtils.DEFAULT_BORDER_COLOR;
  RasterLayerLegendHelper helper=new RasterLayerLegendHelper(request,style,null);
  List<ColorMapEntryLegendBuilder> rows=new ArrayList<>(helper.getcMapLegendCreator().getBodyRows());
  assertEquals(2,rows.size());
  ColorMapEntryLegendBuilder firstRow=rows.get(0);
  assertEquals(colourToTest,firstRow.getColorManager().borderColor);
  assertEquals(colourToTest,firstRow.getRuleManager().borderColor);
  ColorMapEntryLegendBuilder midRow=rows.get(1);
  assertEquals(colourToTest,midRow.getColorManager().borderColor);
  assertEquals(colourToTest,midRow.getRuleManager().borderColor);
  Map<String,Object> legendOptions=new HashMap<String,Object>();
  colourToTest=Color.red;
  legendOptions.put("borderColor",SLD.toHTMLColor(colourToTest));
  request.setLegendOptions(legendOptions);
  helper=new RasterLayerLegendHelper(request,style,null);
  rows=new ArrayList<>(helper.getcMapLegendCreator().getBodyRows());
  assertEquals(2,rows.size());
  firstRow=rows.get(0);
  assertEquals(colourToTest,firstRow.getColorManager().borderColor);
  assertEquals(colourToTest,firstRow.getRuleManager().borderColor);
  midRow=rows.get(1);
  assertEquals(colourToTest,midRow.getColorManager().borderColor);
  assertEquals(colourToTest,midRow.getRuleManager().borderColor);
  colourToTest=Color.blue;
  legendOptions.put("borderColor",SLD.toHTMLColor(colourToTest));
  request.setLegendOptions(legendOptions);
  helper=new RasterLayerLegendHelper(request,style,null);
  rows=new ArrayList<>(helper.getcMapLegendCreator().getBodyRows());
  assertEquals(2,rows.size());
  firstRow=rows.get(0);
  assertEquals(colourToTest,firstRow.getColorManager().borderColor);
  assertEquals(colourToTest,firstRow.getRuleManager().borderColor);
  midRow=rows.get(1);
  assertEquals(colourToTest,midRow.getColorManager().borderColor);
  assertEquals(colourToTest,midRow.getRuleManager().borderColor);
}
