{
  layer=layer != null ? layer : this.layer;
  if (style == null) {
    if (!layer.equals(this.layer)) {
      style=layer.getDefaultStyle();
    }
 else {
    }
  }
  try {
    SimpleHash model=new SimpleHash();
    model.put("markupId",getMarkupId());
    model.put("layers",layer.getName());
    model.put("styles",style.getName());
    bbox(layer,model);
    model.put("ran",rand.nextInt());
    model.put("layerChanged",!layer.equals(this.layer));
    HttpServletRequest req=GeoServerApplication.get().servletRequest();
    model.put("geoserver",ResponseUtils.baseURL(req));
    target.appendJavaScript(renderTemplate("OL-update.ftl",model));
    this.layer=layer;
    this.style=style;
  }
 catch (  Exception e) {
    throw new RuntimeException(e);
  }
}
