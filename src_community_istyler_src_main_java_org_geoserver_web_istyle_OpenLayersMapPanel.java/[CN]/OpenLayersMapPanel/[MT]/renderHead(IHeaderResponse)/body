{
  try {
    SimpleHash model=new SimpleHash();
    model.put("markupId",getMarkupId());
    response.render(StringHeaderItem.forString(renderTemplate("OL-css.ftl",model)));
    response.render(JavaScriptReferenceHeaderItem.forUrl("http://openlayers.org/api/OpenLayers.js"));
    model.put("layers",layer.getName());
    model.put("styles",style.getName());
    HttpServletRequest req=GeoServerApplication.get().servletRequest();
    model.put("geoserver",ResponseUtils.baseURL(req));
    bbox(layer,model);
    model.put("ran",rand.nextInt());
    response.render(OnLoadHeaderItem.forScript(renderTemplate("OL-onload.ftl",model)));
  }
 catch (  Exception e) {
    throw new RuntimeException(e);
  }
}
