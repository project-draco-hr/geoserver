{
  File actualFile=file();
  if (!actualFile.exists()) {
    throw new IllegalStateException("File not found " + actualFile);
  }
  final Lock lock=lock();
  try {
    return new FileInputStream(file){
      @Override public void close() throws IOException {
        super.close();
        lock.release();
      }
    }
;
  }
 catch (  FileNotFoundException e) {
    lock.release();
    throw new IllegalStateException("File not found " + actualFile,e);
  }
}
