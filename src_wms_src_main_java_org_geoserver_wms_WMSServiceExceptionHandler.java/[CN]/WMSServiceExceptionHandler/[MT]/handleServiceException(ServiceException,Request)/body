{
  final String exceptions;
  final int width;
  final int height;
  final String format;
  final Color bgcolor;
  final Boolean transparent;
  try {
    exceptions=(String)request.getKvp().get("EXCEPTIONS");
    width=(Integer)request.getKvp().get("WIDTH");
    height=(Integer)request.getKvp().get("HEIGHT");
    format=(String)request.getKvp().get("FORMAT");
    bgcolor=(Color)request.getKvp().get("BGCOLOR");
    transparent=(Boolean)request.getKvp().get("TRANSPARENT");
  }
 catch (  Exception e) {
    handleXmlException(exception,request);
    return;
  }
  if (exceptions == null || !isImageExceptionType(exceptions) || width <= 0 || height <= 0 || !FORMATS.contains(format)) {
    handleXmlException(exception,request);
    return;
  }
  handleImageException(exception,request,width,height,format,exceptions,bgcolor,transparent);
}
