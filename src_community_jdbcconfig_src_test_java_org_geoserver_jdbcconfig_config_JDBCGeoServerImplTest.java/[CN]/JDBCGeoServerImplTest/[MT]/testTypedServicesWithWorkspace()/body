{
  WorkspaceInfo ws1=geoServer.getCatalog().getFactory().createWorkspace();
  ws1.setName("TEST-WORKSPACE-1");
  geoServer.getCatalog().add(ws1);
  ServiceInfo ws1wms=new org.geoserver.wms.WMSInfoImpl();
  ws1wms.setWorkspace(ws1);
  ws1wms.setName("WMS1");
  ws1wms.setTitle("WMS for WS1");
  geoServer.add(ws1wms);
  ServiceInfo ws1wfs=new org.geoserver.wfs.WFSInfoImpl();
  ws1wfs.setWorkspace(ws1);
  ws1wfs.setName("WFS1");
  ws1wfs.setTitle("WFS for WS1");
  geoServer.add(ws1wfs);
  ServiceInfo gwms=new org.geoserver.wms.WMSInfoImpl();
  gwms.setName("WMSG");
  gwms.setTitle("Global WMS");
  geoServer.add(gwms);
  ServiceInfo gwfs=new org.geoserver.wfs.WFSInfoImpl();
  gwfs.setName("WFSG");
  gwfs.setTitle("Global WFS");
  geoServer.add(gwfs);
  WorkspaceInfo ws2=geoServer.getCatalog().getFactory().createWorkspace();
  ws2.setName("TEST-WORKSPACE-2");
  geoServer.getCatalog().add(ws2);
  ServiceInfo ws2wms=new org.geoserver.wms.WMSInfoImpl();
  ws2wms.setWorkspace(ws2);
  ws2wms.setName("WMS2");
  ws2wms.setTitle("WMS for WS2");
  geoServer.add(ws2wms);
  ServiceInfo ws2wfs=new org.geoserver.wfs.WFSInfoImpl();
  ws2wfs.setWorkspace(ws2);
  ws2wfs.setName("WFS2");
  ws2wfs.setTitle("WFS for WS2");
  geoServer.add(ws2wfs);
  assertThat(geoServer.getService(org.geoserver.wms.WMSInfo.class),equalTo(gwms));
  assertThat(geoServer.getService(org.geoserver.wfs.WFSInfo.class),equalTo(gwfs));
  assertThat((Collection<ServiceInfo>)geoServer.getServices(),allOf(hasItems(gwms,gwfs),not(hasItems(ws1wms,ws1wfs,ws2wms,ws2wfs))));
  assertThat(geoServer.getService(ws1,org.geoserver.wms.WMSInfo.class),equalTo(ws1wms));
  assertThat(geoServer.getService(ws1,org.geoserver.wfs.WFSInfo.class),equalTo(ws1wfs));
  assertThat((Collection<ServiceInfo>)geoServer.getServices(ws1),allOf(hasItems(ws1wms,ws1wfs),not(hasItems(gwms,gwfs,ws2wms,ws2wfs))));
  assertThat(geoServer.getService(ws2,org.geoserver.wms.WMSInfo.class),equalTo(ws2wms));
  assertThat(geoServer.getService(ws2,org.geoserver.wfs.WFSInfo.class),equalTo(ws2wfs));
  assertThat((Collection<ServiceInfo>)geoServer.getServices(ws2),allOf(hasItems(ws2wms,ws2wfs),not(hasItems(gwms,gwfs,ws1wms,ws1wfs))));
}
