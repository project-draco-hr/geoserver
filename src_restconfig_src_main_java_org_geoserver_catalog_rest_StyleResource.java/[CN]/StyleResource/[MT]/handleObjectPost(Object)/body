{
  String workspace=getAttribute("workspace");
  String layer=getAttribute("layer");
  if (object instanceof StyleInfo) {
    StyleInfo style=(StyleInfo)object;
    if (layer != null) {
      StyleInfo existing=catalog.getStyleByName(style.getName());
      if (existing == null) {
        throw new RestletException("No such style: " + style.getName(),Status.CLIENT_ERROR_NOT_FOUND);
      }
      LayerInfo l=catalog.getLayerByName(layer);
      l.getStyles().add(existing);
      String def=getRequest().getResourceRef().getQueryAsForm().getFirstValue("default");
      if ("true".equals(def)) {
        l.setDefaultStyle(existing);
      }
      catalog.save(l);
      LOGGER.info("POST style " + style.getName() + " to layer "+ layer);
    }
 else {
      if (workspace != null) {
        style.setWorkspace(catalog.getWorkspaceByName(workspace));
      }
      catalog.add(style);
      LOGGER.info("POST style " + style.getName());
    }
    return style.getName();
  }
 else   if (object instanceof Style || object instanceof InputStream) {
    String name=getRequest().getResourceRef().getQueryAsForm().getFirstValue("name");
    ;
    if (name == null) {
      name=findNameFromObject(object);
    }
    if (catalog.getStyleByName(workspace,name) != null) {
      throw new RestletException("Style " + name + " already exists.",Status.CLIENT_ERROR_FORBIDDEN);
    }
    StyleHandler styleFormat=((StyleFormat)getFormatPostOrPut()).getHandler();
    StyleInfo sinfo=catalog.getFactory().createStyle();
    sinfo.setName(name);
    sinfo.setFilename(name + "." + styleFormat.getFileExtension());
    sinfo.setFormat(styleFormat.getFormat());
    sinfo.setFormatVersion(styleFormat.versionForMimeType(getRequest().getEntity().getMediaType().getName()));
    if (workspace != null) {
      sinfo.setWorkspace(catalog.getWorkspaceByName(workspace));
    }
    GeoServerDataDirectory dataDir=new GeoServerDataDirectory(catalog.getResourceLoader());
    if (dataDir.style(sinfo).getType() != Resource.Type.UNDEFINED) {
      String msg="Style resource " + sinfo.getFilename() + " already exists.";
      throw new RestletException(msg,Status.CLIENT_ERROR_FORBIDDEN);
    }
    ResourcePool resourcePool=catalog.getResourcePool();
    try {
      if (object instanceof Style) {
        resourcePool.writeStyle(sinfo,(Style)object);
      }
 else {
        resourcePool.writeStyle(sinfo,(InputStream)object);
      }
    }
 catch (    IOException e) {
      throw new RestletException("Error writing style",Status.SERVER_ERROR_INTERNAL,e);
    }
    catalog.add(sinfo);
    LOGGER.info("POST Style " + name);
    return name;
  }
  return null;
}
