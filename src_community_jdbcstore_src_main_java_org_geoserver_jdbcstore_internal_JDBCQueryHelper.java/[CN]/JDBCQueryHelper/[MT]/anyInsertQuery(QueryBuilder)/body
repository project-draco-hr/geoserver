{
  try (Connection c=ds.getConnection()){
    LOGGER.log(Level.FINEST,query.toString());
    PreparedStatement stmt=query.toStatement(c,Statement.RETURN_GENERATED_KEYS);
    try {
      if (stmt.executeUpdate() <= 0) {
        return null;
      }
      ResultSet rs=stmt.getGeneratedKeys();
      List<Integer> list=new ArrayList<Integer>();
      while (rs.next()) {
        list.add(rs.getInt(1));
      }
      rs.close();
      return list;
    }
  finally {
      stmt.close();
    }
  }
 catch (  SQLException ex) {
    throw new IllegalStateException("InsertQuery Failed",ex);
  }
}
