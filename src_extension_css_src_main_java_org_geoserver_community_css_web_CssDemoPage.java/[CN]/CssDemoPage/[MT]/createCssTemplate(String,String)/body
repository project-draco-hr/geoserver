{
  try {
    Catalog catalog=getCatalog();
    if (catalog.getStyleByName(workspace,name) == null) {
      StyleInfo style=catalog.getFactory().createStyle();
      style.setName(name);
      style.setFilename(name + ".sld");
      if (workspace != null) {
        WorkspaceInfo ws=catalog.getWorkspaceByName(workspace);
        if (ws == null) {
          throw new WicketRuntimeException("Workspace does not exist: " + workspace);
        }
        style.setWorkspace(ws);
      }
      Resource sld=findStyleFile(style);
      if (sld == null || !Resources.exists(sld)) {
        catalog.getResourcePool().writeStyle(style,new ByteArrayInputStream(cssText2sldText(defaultStyle,style).getBytes()));
        sld=findStyleFile(style);
      }
      Resource css=sld.parent().get(name + ".css");
      if (!Resources.exists(css)) {
        OutputStreamWriter writer=new OutputStreamWriter(css.out());
        writer.write(defaultStyle);
        writer.close();
      }
      catalog.add(style);
    }
  }
 catch (  IOException ioe) {
    throw new WicketRuntimeException(ioe);
  }
}
