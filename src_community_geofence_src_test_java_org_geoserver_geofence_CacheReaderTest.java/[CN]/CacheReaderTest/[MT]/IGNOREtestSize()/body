{
  CustomTicker ticker=new CustomTicker();
  CacheConfiguration config=new CacheConfiguration();
  config.setSize(2);
  config.setRefreshMilliSec(500);
  config.setExpireMilliSec(1000);
  config.setCustomTicker(ticker);
  configManager.setCacheConfiguration(config);
  CachedRuleReader cachedRuleReader=new CachedRuleReader(configManager);
  cachedRuleReader.setRealRuleReaderService(realReader);
  System.out.println(cachedRuleReader.getStats());
  assertEquals(0,cachedRuleReader.getStats().hitCount());
  assertEquals(0,cachedRuleReader.getStats().missCount());
  assertEquals(0,cachedRuleReader.getStats().evictionCount());
  RuleFilter filter1=new RuleFilter();
  filter1.setUser("test_1");
  RuleFilter filter2=new RuleFilter();
  filter2.setUser("test_2");
  RuleFilter filter3=new RuleFilter();
  filter3.setUser("test_3");
  assertNotSame(filter1,filter2);
  int hitExp=0;
  int missExp=0;
  int evictExp=0;
  AccessInfo ai1_1=cachedRuleReader.getAccessInfo(filter1);
  System.out.println(cachedRuleReader.getStats());
  assertEquals(hitExp,cachedRuleReader.getStats().hitCount());
  assertEquals(++missExp,cachedRuleReader.getStats().missCount());
  assertEquals(evictExp,cachedRuleReader.getStats().evictionCount());
  ticker.setMillisec(1);
  AccessInfo ai1_2=cachedRuleReader.getAccessInfo(filter1);
  System.out.println(cachedRuleReader.getStats());
  assertEquals(++hitExp,cachedRuleReader.getStats().hitCount());
  assertEquals(missExp,cachedRuleReader.getStats().missCount());
  assertEquals(evictExp,cachedRuleReader.getStats().evictionCount());
  assertEquals(ai1_1,ai1_2);
  ticker.setMillisec(2);
  AccessInfo ai2=cachedRuleReader.getAccessInfo(filter2);
  System.out.println(cachedRuleReader.getStats());
  assertEquals(hitExp,cachedRuleReader.getStats().hitCount());
  assertEquals(++missExp,cachedRuleReader.getStats().missCount());
  assertEquals(evictExp,cachedRuleReader.getStats().evictionCount());
  ticker.setMillisec(3);
  AccessInfo ai3=cachedRuleReader.getAccessInfo(filter3);
  System.out.println(cachedRuleReader.getStats());
  assertEquals(hitExp,cachedRuleReader.getStats().hitCount());
  assertEquals(++missExp,cachedRuleReader.getStats().missCount());
  assertEquals(++evictExp,cachedRuleReader.getStats().evictionCount());
  ticker.setMillisec(4);
  cachedRuleReader.getAccessInfo(filter2);
  System.out.println(cachedRuleReader.getStats());
  assertEquals(++hitExp,cachedRuleReader.getStats().hitCount());
  ticker.setMillisec(5);
  cachedRuleReader.getAccessInfo(filter3);
  System.out.println(cachedRuleReader.getStats());
  assertEquals(++hitExp,cachedRuleReader.getStats().hitCount());
  ticker.setMillisec(6);
  cachedRuleReader.getAccessInfo(filter1);
  System.out.println(cachedRuleReader.getStats());
  assertEquals(hitExp,cachedRuleReader.getStats().hitCount());
  assertEquals(++missExp,cachedRuleReader.getStats().missCount());
  assertEquals(++evictExp,cachedRuleReader.getStats().evictionCount());
}
