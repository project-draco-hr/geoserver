{
  final Enumeration<? extends ZipEntry> entries=archive.entries();
  try {
    while (entries.hasMoreElements()) {
      ZipEntry entry=(ZipEntry)entries.nextElement();
      if (!entry.isDirectory()) {
        final String name=entry.getName();
        final String ext=FilenameUtils.getExtension(name);
        final InputStream in=new BufferedInputStream(archive.getInputStream(entry));
        final File outFile=new File(outputDirectory,fileName != null ? new StringBuilder(fileName).append(".").append(ext).toString() : name);
        final OutputStream out=new BufferedOutputStream(new FileOutputStream(outFile));
        IOUtils.copyStream(in,out,true,true);
      }
 else {
        new File(outputDirectory,entry.getName()).mkdirs();
      }
    }
  }
  finally {
    try {
      archive.close();
    }
 catch (    Throwable e) {
      if (LOGGER.isLoggable(Level.FINE))       LOGGER.isLoggable(Level.FINE);
    }
  }
}
