{
  double pixelsPerMeters=RendererUtilities.calculatePixelsPerMeterRatio(request.getScale(),request.getLegendOptions());
  UomRescaleStyleVisitor rescaleVisitor=new UomRescaleStyleVisitor(pixelsPerMeters);
  rescaleVisitor.visit(sld);
  Style newSld=(Style)rescaleVisitor.getCopy();
  double dpi=RendererUtilities.getDpi(request.getLegendOptions());
  double standardDpi=RendererUtilities.getDpi(Collections.emptyMap());
  if (dpi != standardDpi) {
    double scaleFactor=dpi / standardDpi;
    RescaleStyleVisitor dpiVisitor=new RescaleStyleVisitor(scaleFactor);
    dpiVisitor.visit(sld);
    newSld=(Style)dpiVisitor.getCopy();
  }
  return newSld;
}
