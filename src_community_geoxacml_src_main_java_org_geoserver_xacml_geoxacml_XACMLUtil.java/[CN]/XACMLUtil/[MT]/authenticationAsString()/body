{
  Authentication auth=SecurityContextHolder.getContext().getAuthentication();
  if (auth == null)   return "anonymous";
  String userName=auth.getCredentials() instanceof UserDetails ? ((UserDetails)auth.getPrincipal()).getUsername() : auth.getCredentials().toString();
  StringBuffer buff=new StringBuffer(userName);
  buff.append(" [ ");
  for (  GrantedAuthority ga : auth.getAuthorities()) {
    buff.append(ga.getAuthority()).append(",");
  }
  if (auth.getAuthorities().length > 0)   buff.setLength(buff.length() - 1);
  buff.append(" ] ");
  return buff.toString();
}
