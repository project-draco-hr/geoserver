{
  final List proxies=XmlUtils.getTextForElements(response,"proxy");
  final String[] proxiedList=(String[])proxies.toArray(new String[proxies.size()]);
  if (proxiedList.length > 0) {
    assertion.getAttributes().put(GeoServerCasConstants.CAS_PROXYLIST_KEY,proxiedList);
    LOGGER.info("Proxy ticket validated");
  }
 else {
    LOGGER.info("Service ticket validated");
  }
  if (proxies == null || proxies.isEmpty() || this.acceptAnyProxy) {
    return;
  }
  if (allowedProxyChains.contains(proxiedList)) {
    return;
  }
  throw new InvalidProxyChainTicketValidationException("Invalid proxy chain: " + proxies.toString());
}
