{
  KMLSuperOverlayTransformer transformer=new KMLSuperOverlayTransformer(getWMS(),mapContent);
  transformer.setIndentation(2);
  mapContent.getViewport().setBounds(new ReferencedEnvelope(0,180,-90,90,DefaultGeographicCRS.WGS84));
  Map<String,Object> formatOptions=new HashMap<String,Object>();
  formatOptions.put("kmltitle","myCustomLayerTitle");
  mapContent.getRequest().setFormatOptions(formatOptions);
  ByteArrayOutputStream output=new ByteArrayOutputStream();
  transformer.transform(Layer,output);
  DocumentBuilder docBuilder=DocumentBuilderFactory.newInstance().newDocumentBuilder();
  Document document=docBuilder.parse(new ByteArrayInputStream(output.toByteArray()));
  assertEquals("kml",document.getDocumentElement().getNodeName());
  assertEquals("myCustomLayerTitle",document.getElementsByTagName("Document").item(0).getFirstChild().getNextSibling().getTextContent());
}
