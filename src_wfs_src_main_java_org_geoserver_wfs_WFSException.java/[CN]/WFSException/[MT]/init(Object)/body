{
  if (request != null) {
    if (OwsUtils.has(request,"version")) {
      Object ver=OwsUtils.get(request,"version");
      Version version=Version.negotiate(ver != null ? ver.toString() : null);
      if (version != null && version.compareTo(Version.V_20) < 0) {
        return this;
      }
    }
    if (locator == null && OwsUtils.has(request,"handle")) {
      locator=(String)OwsUtils.get(request,"handle");
    }
    if (locator == null) {
      String className=request.getClass().getSimpleName();
      if (request instanceof RequestObject) {
        className=request.getClass().getSuperclass().getSimpleName();
        locator=className.substring(0,className.length() - "Request".length());
      }
 else       if (className.endsWith("TypeImpl")) {
        locator=className.substring(0,className.length() - "TypeImpl".length());
      }
    }
    if (code == null) {
      code=Code.OperationProcessingFailed.name();
    }
  }
  return this;
}
