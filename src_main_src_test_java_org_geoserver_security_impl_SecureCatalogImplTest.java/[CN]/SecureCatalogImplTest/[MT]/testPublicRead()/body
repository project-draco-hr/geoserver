{
  ResourceAccessManager manager=buildManager("publicRead.properties");
  SecureCatalogImpl sc=new SecureCatalogImpl(catalog,manager);
  SecurityContextHolder.getContext().setAuthentication(roUser);
  assertSame(arcGrid,sc.getCoverageByName("nurc:arcgrid"));
  assertSame(arcGrid,sc.getResourceByName("nurc:arcgrid",CoverageInfo.class));
  assertEquals(coverages,sc.getCoverages());
  assertEquals(workspaces,sc.getWorkspaces());
  assertEquals(toppWs,sc.getWorkspaceByName("topp"));
  assertSame(arcGridStore,sc.getCoverageStoreByName("arcGrid"));
  assertNotNull(sc.getFeatureTypeByName("topp:states"));
  assertTrue(sc.getFeatureTypeByName("topp:states") instanceof SecuredFeatureTypeInfo);
  assertTrue(sc.getResourceByName("topp:states",FeatureTypeInfo.class) instanceof SecuredFeatureTypeInfo);
  assertEquals(featureTypes.size(),sc.getFeatureTypes().size());
  for (  FeatureTypeInfo ft : sc.getFeatureTypes()) {
    assertTrue(ft instanceof SecuredFeatureTypeInfo);
  }
  assertNotNull(sc.getLayerByName("topp:states"));
  assertTrue(sc.getLayerByName("topp:states") instanceof SecuredLayerInfo);
  assertTrue(sc.getDataStoreByName("states") instanceof SecuredDataStoreInfo);
  assertTrue(sc.getDataStoreByName("roads") instanceof SecuredDataStoreInfo);
  SecurityContextHolder.getContext().setAuthentication(rwUser);
  assertSame(states,sc.getFeatureTypeByName("topp:states"));
  assertSame(arcGrid,sc.getCoverageByName("nurc:arcgrid"));
  assertSame(states,sc.getResourceByName("topp:states",FeatureTypeInfo.class));
  assertSame(arcGrid,sc.getResourceByName("nurc:arcgrid",CoverageInfo.class));
  assertEquals(featureTypes,sc.getFeatureTypes());
  assertEquals(coverages,sc.getCoverages());
  assertEquals(workspaces,sc.getWorkspaces());
  assertEquals(toppWs,sc.getWorkspaceByName("topp"));
  assertSame(statesStore,sc.getDataStoreByName("states"));
  assertSame(roadsStore,sc.getDataStoreByName("roads"));
  assertSame(arcGridStore,sc.getCoverageStoreByName("arcGrid"));
}
