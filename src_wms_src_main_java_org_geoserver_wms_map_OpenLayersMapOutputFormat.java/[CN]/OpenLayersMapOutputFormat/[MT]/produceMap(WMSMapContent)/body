{
  try {
    Template template=cfg.getTemplate("OpenLayersMapTemplate.ftl");
    HashMap<String,Object> map=new HashMap<String,Object>();
    map.put("context",mapContent);
    map.put("pureCoverage",hasOnlyCoverages(mapContent));
    map.put("styles",styleNames(mapContent));
    map.put("request",mapContent.getRequest());
    map.put("maxResolution",new Double(getMaxResolution(mapContent.getRenderingArea())));
    String baseUrl=mapContent.getRequest().getBaseUrl();
    map.put("baseUrl",canonicUrl(baseUrl));
    String servicePath="wms";
    if (LocalLayer.get() != null) {
      servicePath=LocalLayer.get().getName() + "/" + servicePath;
    }
    if (LocalWorkspace.get() != null) {
      servicePath=LocalWorkspace.get().getName() + "/" + servicePath;
    }
    map.put("servicePath",servicePath);
    map.put("parameters",getLayerParameter(mapContent.getRequest().getRawKvp()));
    map.put("units",getOLUnits(mapContent.getRequest()));
    if (mapContent.layers().size() == 1) {
      map.put("layerName",mapContent.layers().get(0).getTitle());
    }
 else {
      map.put("layerName","Geoserver layers");
    }
    template.setOutputEncoding("UTF-8");
    ByteArrayOutputStream buff=new ByteArrayOutputStream();
    template.process(map,new OutputStreamWriter(buff,Charset.forName("UTF-8")));
    RawMap result=new RawMap(mapContent,buff,MIME_TYPE);
    return result;
  }
 catch (  TemplateException e) {
    throw new ServiceException(e);
  }
}
