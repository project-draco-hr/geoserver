{
  Version requestVersion=WMS.version(request.getVersion());
  if (!WMS.VERSION_1_3_0.equals(requestVersion)) {
    return;
  }
  MetadataMap serviceMetadata=wms.getMetadata();
  Boolean createExtendedCapabilities=(Boolean)serviceMetadata.get(CREATE_EXTENDED_CAPABILITIES.key);
  String metadataURL=(String)serviceMetadata.get(SERVICE_METADATA_URL.key);
  if (metadataURL == null || createExtendedCapabilities != null && !createExtendedCapabilities) {
    return;
  }
  String mediaType=(String)serviceMetadata.get(SERVICE_METADATA_TYPE.key);
  String language=(String)serviceMetadata.get(LANGUAGE.key);
  tx.start("inspire_vs:ExtendedCapabilities");
  tx.start("inspire_common:MetadataUrl");
  tx.start("inspire_common:URL");
  tx.chars(metadataURL);
  tx.end("inspire_common:URL");
  if (mediaType != null) {
    tx.start("inspire_common:MediaType");
    tx.chars(mediaType);
    tx.end("inspire_common:MediaType");
  }
  tx.end("inspire_common:MetadataUrl");
  tx.start("inspire_common:SupportedLanguages");
  language=language != null ? language : "eng";
  tx.start("inspire_common:DefaultLanguage");
  tx.start("inspire_common:Language");
  tx.chars(language);
  tx.end("inspire_common:Language");
  tx.end("inspire_common:DefaultLanguage");
  tx.end("inspire_common:SupportedLanguages");
  tx.start("inspire_common:ResponseLanguage");
  tx.start("inspire_common:Language");
  tx.chars(language);
  tx.end("inspire_common:Language");
  tx.end("inspire_common:ResponseLanguage");
  tx.end("inspire_vs:ExtendedCapabilities");
}
