{
  File datastorePropertiesFile=new File(dir,"datastore.properties");
  if (datastorePropertiesFile.exists()) {
    Properties datastoreProperties=loadProperties(datastorePropertiesFile);
    Map<String,Serializable> params=Utils.createDataStoreParamsFromPropertiesFile(datastoreProperties,dataStoreFactory);
    params.put("dbtype",getDbType(dataStoreFactory));
    return params;
  }
 else {
    File shpFile=new File(dir,dir.getName() + ".shp");
    Map<String,Serializable> params=new HashMap<String,Serializable>();
    params.put(ShapefileDataStoreFactory.URLP.key,"file://" + shpFile.getAbsolutePath());
    params.put(ShapefileDataStoreFactory.MEMORY_MAPPED.key,true);
    return params;
  }
}
