{
  RequestCycle cycle=RequestCycle.get();
  ServletWebRequest req=(ServletWebRequest)cycle.getRequest();
  HttpSession s=(HttpSession)req.getHttpServletRequest().getSession(false);
  StandardPBEByteEncryptor enc=null;
  if (s != null) {
    enc=(StandardPBEByteEncryptor)s.getAttribute(URLParamEncryptionHttpSessionListener.SESSION_PARAM_NAME);
    if (enc == null) {
      URLParamEncryptionHttpSessionListener.addEncrypterToSession(GeoServerApplication.get().getSecurityManager(),s);
      LOGGER.warning("Url parameter encrypter set on the fly");
    }
  }
  if (enc == null) {
    LOGGER.warning("No Url parameter encrypter available");
    return NoCrypt;
  }
 else {
    return new CryptImpl(enc);
  }
}
