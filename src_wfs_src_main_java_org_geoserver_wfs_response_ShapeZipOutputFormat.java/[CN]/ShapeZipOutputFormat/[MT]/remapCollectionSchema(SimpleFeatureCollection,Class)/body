{
  SimpleFeatureType schema=fc.getSchema();
  if (targetGeometry != null) {
    SimpleFeatureTypeBuilder tb=new SimpleFeatureTypeBuilder();
    for (    AttributeDescriptor ad : schema.getAttributeDescriptors()) {
      if (!(ad instanceof GeometryDescriptor)) {
        tb.add(ad);
      }
 else {
        Class geomType=ad.getType().getBinding();
        if (geomType.equals(Geometry.class) || geomType.equals(GeometryCollection.class)) {
          tb.add(ad.getName().getLocalPart(),targetGeometry,((GeometryDescriptor)ad).getCoordinateReferenceSystem());
        }
 else {
          tb.add(ad);
        }
      }
    }
    tb.setName(fc.getSchema().getName());
    SimpleFeatureType retyped=tb.buildFeatureType();
    fc=new RetypingFeatureCollection(fc,retyped);
  }
  Map<String,String> attributeMappings=createAttributeMappings(schema);
  return new RemappingFeatureCollection(fc,attributeMappings);
}
