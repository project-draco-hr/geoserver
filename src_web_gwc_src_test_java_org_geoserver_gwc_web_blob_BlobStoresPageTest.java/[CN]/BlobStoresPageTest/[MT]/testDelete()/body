{
  BlobStoresPage page=new BlobStoresPage();
  tester.startPage(page);
  GeoServerTablePanel table=(GeoServerTablePanel)tester.getComponentFromLastRenderedPage("storesPanel");
  BlobStoreConfig dummy1=dummyStore1();
  GWC.get().addBlobStore(dummy1);
  assertTrue(GWC.get().getBlobStores().contains(dummy1));
  tester.clickLink("storesPanel:listContainer:sortableLinks:0:header:link",true);
  tester.clickLink("storesPanel:listContainer:sortableLinks:0:header:link",true);
  CheckBox selector=((CheckBox)tester.getComponentFromLastRenderedPage("storesPanel:listContainer:items:1:selectItemContainer:selectItem"));
  tester.getServletRequest().setParameter(selector.getInputName(),"true");
  tester.executeAjaxEvent(selector,"onclick");
  assertEquals(1,table.getSelection().size());
  assertEquals(dummy1,table.getSelection().get(0));
  tester.clickLink("headerPanel:removeSelected",true);
  assertFalse(GWC.get().getBlobStores().contains(dummy1));
  GWC.get().addBlobStore(dummy1);
  assertTrue(GWC.get().getBlobStores().contains(dummy1));
  TileLayer layer=GWC.get().getTileLayerByName("cite:Lakes");
  layer.setBlobStoreId(ID_DUMMY1);
  assertEquals(ID_DUMMY1,layer.getBlobStoreId());
  GWC.get().save(layer);
  tester.clickLink("storesPanel:listContainer:sortableLinks:0:header:link",true);
  tester.clickLink("storesPanel:listContainer:sortableLinks:0:header:link",true);
  selector=((CheckBox)tester.getComponentFromLastRenderedPage("storesPanel:listContainer:items:2:selectItemContainer:selectItem"));
  tester.getServletRequest().setParameter(selector.getInputName(),"true");
  tester.executeAjaxEvent(selector,"onclick");
  assertEquals(1,table.getSelection().size());
  assertEquals(dummy1,table.getSelection().get(0));
  ModalWindow w=(ModalWindow)tester.getComponentFromLastRenderedPage("confirmDeleteDialog:dialog");
  assertFalse(w.isShown());
  tester.clickLink("headerPanel:removeSelected",true);
  assertTrue(w.isShown());
  GeoServerDialog dialog=(GeoServerDialog)tester.getComponentFromLastRenderedPage("confirmDeleteDialog");
  dialog.submit(new AjaxRequestTarget(tester.getLastRenderedPage()));
  assertFalse(GWC.get().getBlobStores().contains(dummy1));
  layer=GWC.get().getTileLayerByName("cite:Lakes");
  assertNull(layer.getBlobStoreId());
}
