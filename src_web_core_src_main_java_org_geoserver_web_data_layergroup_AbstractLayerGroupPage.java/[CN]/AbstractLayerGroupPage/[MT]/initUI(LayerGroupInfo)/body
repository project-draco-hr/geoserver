{
  this.returnPage=LayerGroupPage.class;
  lgModel=new LayerGroupDetachableModel(layerGroup);
  layerGroupId=layerGroup.getId();
  Form form=new Form("form",new CompoundPropertyModel(lgModel));
  add(form);
  TextField name=new TextField("name");
  name.setRequired(true);
  name.add(new GroupNameValidator());
  form.add(name);
  form.add(envelopePanel=new EnvelopePanel("bounds"));
  envelopePanel.setRequired(true);
  envelopePanel.setCRSFieldVisible(true);
  envelopePanel.setOutputMarkupId(true);
  form.add(new GeoServerAjaxFormLink("generateBounds"){
    @Override public void onClick(    AjaxRequestTarget target,    Form form){
      LayerGroupInfo lg=getCatalog().getFactory().createLayerGroup();
      for (      LayerGroupEntry entry : lgEntryPanel.getEntries()) {
        lg.getLayers().add(entry.getLayer());
        lg.getStyles().add(entry.getStyle());
      }
      try {
        CoordinateReferenceSystem crs=envelopePanel.getCoordinateReferenceSystem();
        if (crs != null) {
          new CatalogBuilder(getCatalog()).calculateLayerGroupBounds(lg,crs);
        }
 else {
          new CatalogBuilder(getCatalog()).calculateLayerGroupBounds(lg);
        }
        envelopePanel.setModelObject(lg.getBounds());
        target.addComponent(envelopePanel);
      }
 catch (      Exception e) {
        throw new WicketRuntimeException(e);
      }
    }
  }
);
  form.add(lgEntryPanel=new LayerGroupEntryPanel("layers",layerGroup));
  form.add(extensionPanels=extensionPanels());
  form.add(saveLink());
  form.add(cancelLink());
}
