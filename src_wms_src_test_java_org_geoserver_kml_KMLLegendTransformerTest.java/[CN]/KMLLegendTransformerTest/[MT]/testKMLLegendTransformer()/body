{
  SimpleFeatureCollection features=FeatureCollections.newCollection();
  XpathEngine xpath=XMLUnit.newXpathEngine();
  KMLLegendTransformer transformer=new KMLLegendTransformer(mapContext);
  transformer.setIndentation(2);
  Document dom=WMSTestSupport.transform(mapLayer,transformer);
  assertXpathEvaluatesTo("Legend","//kml/ScreenOverlay/name",dom);
  assertXpathEvaluatesTo("0","//kml/ScreenOverlay/overlayXY/@x",dom);
  assertXpathEvaluatesTo("0","//kml/ScreenOverlay/overlayXY/@y",dom);
  assertXpathEvaluatesTo("pixels","//kml/ScreenOverlay/overlayXY/@xunits",dom);
  assertXpathEvaluatesTo("pixels","//kml/ScreenOverlay/overlayXY/@yunits",dom);
  Map<String,String> expectedKVP=KMLReflectorTest.toKvp("http://geoserver.org:8181/geoserver/wms?service=wms&width=20&height=20&style=Default+Style&request=GetLegendGraphic&layer=&format=image%2Fpng&version=1.1.1");
  Map<String,String> resultantKVP=KMLReflectorTest.toKvp(xpath.evaluate("//kml/ScreenOverlay/Icon/href",dom));
  KMLReflectorTest.assertMapsEqual(expectedKVP,resultantKVP);
}
