{
  try {
    SimpleFeatureSource source=(SimpleFeatureSource)((FeatureLayer)layer).getFeatureSource();
    SimpleFeatureCollection original=source.getFeatures();
    SimpleFeatureCollection centroids=new KMLCentroidFeatureCollection(original);
    FeatureLayer centroidsLayer=new FeatureLayer(centroids,layer.getStyle(),layer.getTitle());
    List<Feature> features=new SequenceList<Feature>(new FeatureSequenceFactory(context,centroidsLayer));
    context.addFeatures(folder,features);
  }
 catch (  IOException e) {
    throw new ServiceException("Failed to load vector data during KML generation",e);
  }
}
