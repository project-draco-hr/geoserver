{
  final String OBSERVATION_ID_PREFIX="observation:";
  Document doc=getAsDOM("wfs?request=GetFeature&typename=om:Observation");
  LOGGER.info("WFS GetFeature&typename=om:Observation response:\n" + prettyString(doc));
  assertXpathEvaluatesTo("4","/wfs:FeatureCollection/@numberOfFeatures",doc);
  assertXpathCount(4,"//om:Observation",doc);
  String id="mf1";
  assertXpathEvaluatesTo(OBSERVATION_ID_PREFIX + id,"(//om:Observation)[1]/@gml:id",doc);
  assertXpathEvaluatesTo("651.0","(//om:Observation)[1]/om:metadata/gsml:CGI_NumericValue/gsml:principalValue",doc);
  Node resultQuality=doc.getElementsByTagName("om:resultQuality").item(0);
  Node geologicUnit=resultQuality.getFirstChild();
  assertEquals("gu.25699",geologicUnit.getAttributes().getNamedItem("gml:id").getNodeValue());
  assertXpathEvaluatesTo(id,"(//om:Observation)[1]/om:result/gsml:MappedFeature/@gml:id",doc);
  id="mf2";
  assertXpathEvaluatesTo(OBSERVATION_ID_PREFIX + id,"(//om:Observation)[2]/@gml:id",doc);
  assertXpathEvaluatesTo("269.0","(//om:Observation)[2]/om:metadata/gsml:CGI_NumericValue/gsml:principalValue",doc);
  resultQuality=doc.getElementsByTagName("om:resultQuality").item(1);
  geologicUnit=resultQuality.getFirstChild();
  assertEquals("gu.25678",geologicUnit.getAttributes().getNamedItem("gml:id").getNodeValue());
  assertXpathEvaluatesTo(id,"(//om:Observation)[2]/om:result/gsml:MappedFeature/@gml:id",doc);
  id="mf3";
  assertXpathEvaluatesTo(OBSERVATION_ID_PREFIX + id,"(//om:Observation)[3]/@gml:id",doc);
  assertXpathEvaluatesTo("123.0","(//om:Observation)[3]/om:metadata/gsml:CGI_NumericValue/gsml:principalValue",doc);
  resultQuality=doc.getElementsByTagName("om:resultQuality").item(2);
  assertEquals("#gu.25678",resultQuality.getAttributes().getNamedItem("xlink:href").getNodeValue());
  assertXpathEvaluatesTo(id,"(//om:Observation)[3]/om:result/gsml:MappedFeature/@gml:id",doc);
  id="mf4";
  assertXpathEvaluatesTo(OBSERVATION_ID_PREFIX + id,"(//om:Observation)[4]/@gml:id",doc);
  assertXpathEvaluatesTo("456.0","(//om:Observation)[4]/om:metadata/gsml:CGI_NumericValue/gsml:principalValue",doc);
  resultQuality=doc.getElementsByTagName("om:resultQuality").item(3);
  geologicUnit=resultQuality.getFirstChild();
  assertEquals("gu.25682",geologicUnit.getAttributes().getNamedItem("gml:id").getNodeValue());
  assertXpathEvaluatesTo(id,"(//om:Observation)[4]/om:result/gsml:MappedFeature/@gml:id",doc);
}
