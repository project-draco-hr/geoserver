{
  List<Dimension> netCDFDimensions=new LinkedList<Dimension>();
  for (  NetCDFDimensionManager manager : dimensionMapping.values()) {
    netCDFDimensions.add(manager.getNetCDFDimension());
  }
  final String coverageName=sampleGranule.getName().toString();
  final int dataType=sampleGranule.getRenderedImage().getSampleModel().getDataType();
  DataType varDataType=NetCDFUtilities.transcodeImageDataType(dataType);
  Variable var=writer.addVariable(null,coverageName,varDataType,netCDFDimensions);
  GridSampleDimension[] sampleDimensions=sampleGranule.getSampleDimensions();
  boolean noDataSet=false;
  double noDataValue=Double.NaN;
  if (sampleDimensions != null && sampleDimensions.length > 0) {
    GridSampleDimension sampleDimension=sampleDimensions[0];
    Unit<?> units=sampleDimension.getUnits();
    double[] noData=sampleDimension.getNoDataValues();
    if (noData != null && noData.length > 0) {
      noDataValue=noData[0];
      noDataSet=true;
    }
    if (units != null) {
      writer.addVariableAttribute(var,new Attribute(NetCDFUtilities.UNITS,units.toString()));
    }
  }
  if (!noDataSet) {
    NoDataContainer noDataProperty=CoverageUtilities.getNoDataProperty(sampleGranule);
    if (noDataProperty != null) {
      noDataValue=noDataProperty.getAsSingleValue();
      noDataSet=true;
    }
  }
  if (noDataSet) {
    writer.addVariableAttribute(var,new Attribute(NetCDFUtilities.FILL_VALUE,NetCDFUtilities.transcodeNumber(varDataType,noDataValue)));
  }
}
