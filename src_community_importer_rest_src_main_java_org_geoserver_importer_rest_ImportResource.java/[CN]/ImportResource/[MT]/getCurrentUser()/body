{
  String user=null;
  Authentication authentication=null;
  try {
    authentication=SecurityContextHolder.getContext().getAuthentication();
    if (authentication != null) {
      user=(String)authentication.getCredentials();
    }
  }
 catch (  NoClassDefFoundError cnfe) {
    try {
      Class clazz=Class.forName("org.springframework.security.core.context.SecurityContextHolder");
      Object context=clazz.getMethod("getContext").invoke(null);
      Object auth=context.getClass().getMethod("getAuthentication").invoke(context);
      user=(String)auth.getClass().getMethod("getCredentials").invoke(auth);
    }
 catch (    Exception ex) {
      throw new RuntimeException(ex);
    }
  }
  if (user == null) {
    user="anonymous";
  }
  return user;
}
