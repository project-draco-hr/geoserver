{
  String mimeType=getMimeType(value,operation);
  String opName=operation.getId();
  String name=null;
  if (mimeType != null) {
    name="geoserver";
    if (opName != null) {
      name=name + "-" + opName;
    }
    String[] typeParts=mimeType.split(";");
    String[] typeAndSubtype=typeParts[0].split("/");
    if (typeAndSubtype.length == 2) {
      String extension=typeAndSubtype[1].split("[^\\p{Alnum}]")[0];
      name=name + "." + extension;
    }
 else {
      final String message="Cannot guess file extension for invalid MIME type: '" + mimeType + "'";
      throw new IllegalStateException(message);
    }
  }
  return name;
}
