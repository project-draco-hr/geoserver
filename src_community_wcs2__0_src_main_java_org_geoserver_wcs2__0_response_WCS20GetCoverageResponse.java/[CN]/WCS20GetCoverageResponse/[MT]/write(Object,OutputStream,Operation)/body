{
  GridCoverage2D coverage=(GridCoverage2D)value;
  GetCoverageType getCoverage=(GetCoverageType)operation.getParameters()[0];
  String format=getCoverage.getFormat();
  if (format == null) {
    format="image/tiff";
  }
  final Map<String,String> encodingParameters=new HashMap<String,String>();
  final ExtensionType extension=getCoverage.getExtension();
  if (extension != null) {
    final EList<ExtensionItemType> extensions=extension.getContents();
    for (    ExtensionItemType ext : extensions) {
      encodingParameters.put(ext.getName(),ext.getSimpleContent());
    }
  }
  CoverageResponseDelegate delegate=responseFactory.encoderFor(format);
  boolean multipart=false;
  String mediaType=getCoverage.getMediaType();
  if (mediaType != null) {
    if (!mediaType.equals("multipart/related")) {
      throw new WCS20Exception("Invalid media type, only valid value is " + "'multipart/related', but got: " + mediaType,OWSExceptionCode.InvalidParameterValue,"MediaType");
    }
    multipart=true;
  }
  delegate.encode(coverage,format,encodingParameters,output);
}
