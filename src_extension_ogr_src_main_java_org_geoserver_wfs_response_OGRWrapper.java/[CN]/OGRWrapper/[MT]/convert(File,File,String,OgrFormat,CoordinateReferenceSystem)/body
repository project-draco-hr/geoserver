{
  List<String> cmd=new ArrayList<String>();
  cmd.add(ogrExecutable);
  cmd.add("-f");
  cmd.add(format.ogrFormat);
  File crsFile=null;
  if (crs != null) {
    crsFile=File.createTempFile("gdal_srs","wkt",inputData.getParentFile());
    cmd.add("-a_srs");
    String s=crs.toWKT();
    s=s.replaceAll("\n\r","").replaceAll("  ","");
    FileUtils.writeStringToFile(crsFile,s);
    cmd.add(crsFile.getAbsolutePath());
  }
  if (format.options != null) {
    for (    String option : format.options) {
      cmd.add(option);
    }
  }
  String outFileName=typeName;
  if (format.fileExtension != null)   outFileName+=format.fileExtension;
  cmd.add(new File(outputDirectory,outFileName).getAbsolutePath());
  cmd.add(inputData.getAbsolutePath());
  StringBuilder sb=new StringBuilder();
  int exitCode=run(cmd,sb);
  if (crsFile != null) {
    crsFile.delete();
  }
  if (exitCode != 0)   throw new IOException("ogr2ogr did not terminate successfully, exit code " + exitCode + ". Was trying to run: "+ cmd+ "\nResulted in:\n"+ sb);
  File output=new File(outputDirectory,outFileName);
  if (output.isDirectory()) {
    output=new File(output,outFileName);
  }
  return output;
}
