{
  Catalog catalog=getCatalog();
  org.geoserver.catalog.FeatureTypeInfo info=catalog.getFeatureTypeByName(layerName.getNamespaceURI(),layerName.getLocalPart());
  LayerInfo layerInfo=catalog.getLayerByName(layerName.getLocalPart());
  Style style=layerInfo.getDefaultStyle().getStyle();
  if (styleName != null) {
    style=catalog.getStyleByName(styleName).getStyle();
  }
  FeatureSource<? extends FeatureType,? extends Feature> featureSource;
  featureSource=info.getFeatureSource(null,null);
  MapLayer layer=new FeatureSourceMapLayer(featureSource,style);
  layer.setTitle(layer.getTitle());
  return layer;
}
