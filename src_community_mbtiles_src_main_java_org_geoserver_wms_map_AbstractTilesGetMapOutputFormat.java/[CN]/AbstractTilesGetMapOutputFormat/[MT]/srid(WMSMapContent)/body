{
  Integer srid=null;
  try {
    srid=CRS.lookupEpsgCode(getCoordinateReferenceSystem(map),false);
    if (srid == null) {
      srid=Integer.parseInt(map.getRequest().getSRS().split(":")[1]);
    }
  }
 catch (  Exception ex) {
    LOGGER.log(Level.WARNING,"Error determining srid",ex);
  }
  return srid;
}
