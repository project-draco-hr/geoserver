{
  Catalog cat=getCatalog();
  DataStoreInfo ds=cat.getFactory().createDataStore();
  ds.setName("sqlviews");
  WorkspaceInfo ws=cat.getDefaultWorkspace();
  ds.setWorkspace(ws);
  Map params=ds.getConnectionParameters();
  params.put("dbtype","h2");
  File dbFile=new File(getTestData().getDataDirectoryRoot().getAbsolutePath(),"data/h2test");
  params.put("database",dbFile.getAbsolutePath());
  cat.add(ds);
  SimpleFeatureSource fsp=getFeatureSource(SystemTestData.PRIMITIVEGEOFEATURE);
  DataStore store=(DataStore)ds.getDataStore(null);
  SimpleFeatureTypeBuilder tb=new SimpleFeatureTypeBuilder();
  tb.init(fsp.getSchema());
  tb.remove("surfaceProperty");
  tb.remove("curveProperty");
  tb.remove("uriProperty");
  tb.setName("pgeo");
  SimpleFeatureType schema=tb.buildFeatureType();
  store.createSchema(schema);
  SimpleFeatureStore featureStore=(SimpleFeatureStore)store.getFeatureSource("pgeo");
  featureStore.addFeatures(fsp.getFeatures());
  CatalogBuilder cb=new CatalogBuilder(cat);
  cb.setStore(ds);
  FeatureTypeInfo tft=cb.buildFeatureType(featureStore);
  cat.add(tft);
  JDBCDataStore jds=(JDBCDataStore)ds.getDataStore(null);
  VirtualTable vt=new VirtualTable("pgeo_view","select \"name\", \"pointProperty\" from \"pgeo\" where \"booleanProperty\" = %bool% and \"name\" = '%name%'");
  vt.addParameter(new VirtualTableParameter("bool","true"));
  vt.addParameter(new VirtualTableParameter("name","name-f001"));
  vt.addGeometryMetadatata("pointProperty",Point.class,4326);
  jds.addVirtualTable(vt);
  FeatureTypeInfo vft=cb.buildFeatureType(jds.getFeatureSource(vt.getName()));
  vft.getMetadata().put(FeatureTypeInfo.JDBC_VIRTUAL_TABLE,vt);
  cat.add(vft);
}
