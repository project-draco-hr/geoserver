{
  VariableState state=(VariableState)(idMap.get(variableId));
  if (state == null)   throw new ProcessingException("variable not supported: " + variableId);
  if (state.type != null)   return state.type;
  VariableDefinition definition=state.definition;
  if (definition == null)   definition=getDefinition(variableId);
  if (definition != null)   return definition.getExpression().getType();
  throw new ProcessingException("we couldn't establish the type: " + variableId);
}
