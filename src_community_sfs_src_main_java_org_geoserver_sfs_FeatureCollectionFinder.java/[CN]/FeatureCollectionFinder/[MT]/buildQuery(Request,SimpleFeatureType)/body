{
  Form form=request.getResourceRef().getQueryAsForm();
  Query query=new Query();
  applyFilter(request,schema,form,query);
  applyAttributeSelection(schema,form,query);
  String fid=RESTUtils.getAttribute(request,"fid");
  if (fid == null) {
    applyMaxFeatures(form,query);
    applyOffset(form,query);
    applyOrderBy(schema,form,query);
  }
  return query;
}
