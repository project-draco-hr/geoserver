{
  int len=hex.length();
  if (len % 2 != 0)   return null;
  int byteCount=len / 2;
  byte[] bytes=new byte[byteCount];
  int charIndex=0;
  for (int byteIndex=0; byteIndex < byteCount; byteIndex++) {
    int hiNibble=hexToBinNibble(hex.charAt(charIndex++));
    int loNibble=hexToBinNibble(hex.charAt(charIndex++));
    if ((hiNibble < 0) || (loNibble < 0))     return null;
    bytes[byteIndex]=(byte)(hiNibble * 16 + loNibble);
  }
  return bytes;
}
