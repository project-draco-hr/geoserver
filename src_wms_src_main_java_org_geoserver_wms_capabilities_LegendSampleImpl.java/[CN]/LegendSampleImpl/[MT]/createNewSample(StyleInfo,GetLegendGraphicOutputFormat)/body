{
  GetLegendGraphicRequest legendGraphicRequest=new GetLegendGraphicRequest();
  File sampleLegendFolder=getSamplesFolder();
  legendGraphicRequest.setStrict(false);
  legendGraphicRequest.setLayers(Arrays.asList((FeatureType)null));
  legendGraphicRequest.setStyles(Arrays.asList(style.getStyle()));
  legendGraphicRequest.setFormat(pngOutputFormat.getContentType());
  Object legendGraphic=pngOutputFormat.produceLegendGraphic(legendGraphicRequest);
  if (legendGraphic instanceof BufferedImageLegendGraphic) {
    BufferedImage image=((BufferedImageLegendGraphic)legendGraphic).getLegend();
    PNGWriter writer=new PNGWriter();
    FileOutputStream outStream=null;
    try {
      File sampleFile=new File(sampleLegendFolder.getAbsolutePath() + File.separator + getSampleFileName(style));
      if (!sampleFile.getParentFile().exists()) {
        sampleFile.getParentFile().mkdirs();
      }
      outStream=new FileOutputStream(sampleFile);
      writer.writePNG(image,outStream,0.0f,FilterType.FILTER_NONE);
      removeStyleSampleInvalidation(style);
      return new Dimension(image.getWidth(),image.getHeight());
    }
  finally {
      if (outStream != null) {
        outStream.close();
      }
    }
  }
  return null;
}
