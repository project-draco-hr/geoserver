{
  Map params=Collections.synchronizedMap(new HashMap(m));
  for (Iterator i=params.entrySet().iterator(); i.hasNext(); ) {
    Map.Entry entry=(Map.Entry)i.next();
    String key=(String)entry.getKey();
    Object value=entry.getValue();
    if ((key != null) && key.matches(".* *url") && value instanceof String) {
      String path=(String)value;
      if (path.startsWith("file:")) {
        File fixedPath=GeoserverDataDirectory.findDataFile(path);
        entry.setValue(DataUtilities.fileToURL(fixedPath).toExternalForm());
      }
    }
 else     if (value instanceof URL && ((URL)value).getProtocol().equals("file")) {
      File fixedPath=GeoserverDataDirectory.findDataFile(((URL)value).toString());
      entry.setValue(DataUtilities.fileToURL(fixedPath));
    }
  }
  return params;
}
