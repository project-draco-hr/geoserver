{
  final AbstractGridFormat gridFormat=info.getFormat();
  if (gridFormat == null) {
    throw new IOException("Could not find the raster plugin for format " + info.getType());
  }
  GridCoverageReader reader=null;
  Object key;
  if (hints != null && info.getId() != null) {
    final String formatName=gridFormat.getName();
    if (formatName.equalsIgnoreCase(IMAGE_MOSAIC) || formatName.equalsIgnoreCase(IMAGE_PYRAMID)) {
      if (coverageExecutor != null) {
        if (hints != null) {
          hints.add(new RenderingHints(Hints.EXECUTOR_SERVICE,coverageExecutor));
        }
 else {
          hints=new Hints(new RenderingHints(Hints.EXECUTOR_SERVICE,coverageExecutor));
        }
      }
    }
    key=new CoverageHintReaderKey(info.getId(),hints);
    reader=(GridCoverageReader)hintCoverageReaderCache.get(key);
  }
 else {
    key=info;
    reader=(GridCoverageReader)coverageReaderCache.get(key);
  }
  if (reader != null) {
    return reader;
  }
synchronized (hints != null ? hintCoverageReaderCache : coverageReaderCache) {
    if (key != null) {
      if (hints != null) {
        reader=(GridCoverageReader)hintCoverageReaderCache.get(key);
      }
 else {
        reader=(GridCoverageReader)coverageReaderCache.get(key);
      }
    }
    if (reader == null) {
      final File obj=GeoserverDataDirectory.findDataFile(info.getURL());
      reader=gridFormat.getReader(obj,hints);
      (hints != null ? hintCoverageReaderCache : coverageReaderCache).put(key,reader);
    }
  }
  return reader;
}
