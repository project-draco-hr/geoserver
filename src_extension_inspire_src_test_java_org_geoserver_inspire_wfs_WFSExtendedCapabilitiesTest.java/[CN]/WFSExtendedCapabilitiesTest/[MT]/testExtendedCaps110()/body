{
  WFSInfo wfs=getGeoServer().getService(WFSInfo.class);
  wfs.getMetadata().put(InspireMetadata.LANGUAGE.key,"fre");
  wfs.getMetadata().put(InspireMetadata.SERVICE_METADATA_URL.key,"http://foo.com?bar=baz");
  wfs.getMetadata().put(InspireMetadata.SPATIAL_DATASET_IDENTIFIER_TYPE.key,"codeOnly");
  getGeoServer().save(wfs);
  Document dom=getAsDOM("wfs?request=getcapabilities&service=wfs&version=1.1.0");
  assertEquals(DLS_NAMESPACE,dom.getDocumentElement().getAttribute("xmlns:inspire_dls"));
  final Element extendedCaps=getFirstElementByTagName(dom,"inspire_dls:ExtendedCapabilities");
  assertNotNull(extendedCaps);
  final Element mdUrl=getFirstElementByTagName(extendedCaps,"inspire_common:MetadataUrl");
  assertNotNull(mdUrl);
  final Element url=getFirstElementByTagName(mdUrl,"inspire_common:URL");
  assertNotNull(url);
  assertEquals("http://foo.com?bar=baz",url.getFirstChild().getNodeValue());
  final Element suppLangs=getFirstElementByTagName(extendedCaps,"inspire_common:SupportedLanguages");
  assertNotNull(suppLangs);
  final Element defLang=getFirstElementByTagName(suppLangs,"inspire_common:DefaultLanguage");
  assertNotNull(defLang);
  final Element defLangVal=getFirstElementByTagName(defLang,"inspire_common:Language");
  assertEquals("fre",defLangVal.getFirstChild().getNodeValue());
  final Element respLang=getFirstElementByTagName(extendedCaps,"inspire_common:ResponseLanguage");
  assertNotNull(respLang);
  final Element respLangVal=getFirstElementByTagName(defLang,"inspire_common:Language");
  assertEquals("fre",respLangVal.getFirstChild().getNodeValue());
  final Element sdi=getFirstElementByTagName(extendedCaps,"inspire_dls:SpatialDataSetIdentifier");
  final Element code=getFirstElementByTagName(sdi,"inspire_common:Code");
  assertEquals("codeOnly",code.getFirstChild().getNodeValue());
  final Element ns=getFirstElementByTagName(sdi,"inspire_common:Namespace");
  assertNull(ns);
}
