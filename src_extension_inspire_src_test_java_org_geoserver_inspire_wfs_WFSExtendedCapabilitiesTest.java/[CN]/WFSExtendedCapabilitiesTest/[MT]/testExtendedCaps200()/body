{
  WFSInfo wfs=getGeoServer().getService(WFSInfo.class);
  wfs.getMetadata().put(InspireMetadata.LANGUAGE.key,"fre");
  wfs.getMetadata().put(InspireMetadata.SERVICE_METADATA_URL.key,"http://foo.com?bar=baz");
  wfs.getMetadata().put(InspireMetadata.SERVICE_METADATA_TYPE.key,"application/vnd.iso.19139+xml");
  wfs.getMetadata().put(InspireMetadata.SPATIAL_DATASET_IDENTIFIER_TYPE.key,"one,http://www.geoserver.org/inspire/one,http://metadata.geoserver.org/id?one");
  getGeoServer().save(wfs);
  final Document dom=getAsDOM(WFS_2_0_0_GETCAPREQUEST);
  XpathEngine xpath=getXpathEngine();
  assertEquals("Existence of ExtendedCapabilities element","1",xpath.evaluate("count(//inspire_dls:ExtendedCapabilities)",dom));
  String schemaLocation=dom.getDocumentElement().getAttribute("xsi:schemaLocation");
  assertTrue(schemaLocation.contains(DLS_NAMESPACE));
  String[] schemaLocationParts=schemaLocation.split("\\s+");
  for (int i=0; i < schemaLocationParts.length; i++) {
    if (schemaLocationParts[i].equals(DLS_NAMESPACE)) {
      assertTrue(schemaLocationParts[i + 1].equals(DLS_SCHEMA));
    }
  }
  assertEquals("Expected MetadataURL URL","http://foo.com?bar=baz",xpath.evaluate("//inspire_dls:ExtendedCapabilities/inspire_common:MetadataUrl/inspire_common:URL",dom));
  assertEquals("Expected MetadataURL MediaType","application/vnd.iso.19139+xml",xpath.evaluate("//inspire_dls:ExtendedCapabilities/inspire_common:MetadataUrl/inspire_common:MediaType",dom));
  assertEquals("Expected default language","fre",xpath.evaluate("//inspire_dls:ExtendedCapabilities/inspire_common:SupportedLanguages/inspire_common:DefaultLanguage/inspire_common:Language",dom));
  assertEquals("Expected response language","fre",xpath.evaluate("//inspire_dls:ExtendedCapabilities/inspire_common:ResponseLanguage/inspire_common:Language",dom));
  assertEquals("Expected response spatial dataset identifier code","one",xpath.evaluate("//inspire_dls:ExtendedCapabilities/inspire_dls:SpatialDataSetIdentifier/inspire_common:Code",dom));
  assertEquals("Expected spatial dataset identifier namespace","http://www.geoserver.org/inspire/one",xpath.evaluate("//inspire_dls:ExtendedCapabilities/inspire_dls:SpatialDataSetIdentifier/inspire_common:Namespace",dom));
  assertEquals("Expected spatial dataset identifier metadata URL attribute","http://metadata.geoserver.org/id?one",xpath.evaluate("//inspire_dls:ExtendedCapabilities/inspire_dls:SpatialDataSetIdentifier/@metadataURL",dom));
}
