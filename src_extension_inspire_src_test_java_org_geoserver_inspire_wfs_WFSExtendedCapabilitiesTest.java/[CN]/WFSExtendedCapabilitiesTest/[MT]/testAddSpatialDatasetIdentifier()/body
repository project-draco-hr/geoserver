{
  WFSInfo wfs=getGeoServer().getService(WFSInfo.class);
  wfs.getMetadata().put(InspireMetadata.LANGUAGE.key,"fre");
  wfs.getMetadata().put(InspireMetadata.SERVICE_METADATA_URL.key,"http://foo.com?bar=baz");
  wfs.getMetadata().put(InspireMetadata.SERVICE_METADATA_TYPE.key,"application/vnd.ogc.csw.GetRecordByIdResponse_xml");
  wfs.getMetadata().put(InspireMetadata.SPATIAL_DATASET_IDENTIFIER_TYPE.key,"one,http://www.geoserver.org/inspire/one,http://metadata.geoserver.org/id?one");
  getGeoServer().save(wfs);
  Document dom=getAsDOM(WFS_2_0_0_GETCAPREQUEST);
  XpathEngine xpath=getXpathEngine();
  NodeList nodeList=dom.getElementsByTagNameNS(DLS_NAMESPACE,"SpatialDataSetIdentifier");
  assertEquals(1,nodeList.getLength());
  wfs.getMetadata().put(InspireMetadata.SPATIAL_DATASET_IDENTIFIER_TYPE.key,"one,http://www.geoserver.org/inspire/one," + ";two,,http://metadata.geoserver.org/id?two");
  getGeoServer().save(wfs);
  dom=getAsDOM(WFS_2_0_0_GETCAPREQUEST);
  nodeList=dom.getElementsByTagNameNS(DLS_NAMESPACE,"SpatialDataSetIdentifier");
  assertEquals(2,nodeList.getLength());
  assertEquals("Expected first spatial dataset identifier namespace","http://www.geoserver.org/inspire/one",xpath.evaluate("//inspire_dls:SpatialDataSetIdentifier[inspire_common:Code = 'one']/inspire_common:Namespace",dom));
  assertEquals("Expected first spatial dataset identifier no metadataURL","0",xpath.evaluate("count(//inspire_dls:SpatialDataSetIdentifier[inspire_common:Code = 'one']/@metadataURL)",dom));
  assertEquals("Expected second spatial dataset identifier metadataURL","http://metadata.geoserver.org/id?two",xpath.evaluate("//inspire_dls:SpatialDataSetIdentifier[inspire_common:Code = 'two']/@metadataURL",dom));
  assertEquals("Expected second spatial dataset identifier no namespace","0",xpath.evaluate("count(//inspire_dls:SpatialDataSetIdentifier[inspire_common:Code = 'two']/inspire_common:Namespace)",dom));
}
