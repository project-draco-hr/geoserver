{
  final String layerName=MockData.BASIC_POLYGONS.getPrefix() + ":" + MockData.BASIC_POLYGONS.getLocalPart();
  String requestUrl="wms/kml?mode=refresh&layers=" + layerName + ","+ layerName+ "&styles=Default,Default&cql_filter=att1<10;att1>1000";
  Document dom=getAsDOM(requestUrl);
  assertEquals("kml",dom.getDocumentElement().getLocalName());
  NodeList folders=dom.getDocumentElement().getElementsByTagName("Folder");
  assertEquals(1,folders.getLength());
  Element folder=(Element)folders.item(0);
  NodeList netLinks=folder.getElementsByTagName("NetworkLink");
  assertEquals(2,netLinks.getLength());
  assertXpathEvaluatesTo(layerName,"kml:kml/kml:Document/kml:Folder/kml:NetworkLink[1]/kml:name",dom);
  assertXpathEvaluatesTo(layerName,"kml:kml/kml:Document/kml:Folder/kml:NetworkLink[2]/kml:name",dom);
  XpathEngine xpath=XMLUnit.newXpathEngine();
  String url1=xpath.evaluate("/kml:kml/kml:Document/kml:Folder/kml:NetworkLink[1]/kml:Url/kml:href",dom);
  String url2=xpath.evaluate("/kml:kml/kml:Document/kml:Folder/kml:NetworkLink[2]/kml:Url/kml:href",dom);
  assertNotNull(url1);
  assertNotNull(url2);
  Map<String,Object> kvp1=KvpUtils.parseQueryString(url1);
  Map<String,Object> kvp2=KvpUtils.parseQueryString(url2);
  assertEquals(layerName,kvp1.get("layers"));
  assertEquals(layerName,kvp2.get("layers"));
  assertEquals("Default",kvp1.get("styles"));
  assertEquals("Default",kvp2.get("styles"));
  assertEquals("att1<10",kvp1.get("cql_filter"));
  assertEquals("att1>1000",kvp2.get("cql_filter"));
}
